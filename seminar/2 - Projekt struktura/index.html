<!DOCTYPE html><html lang="hu" class="no-js"><head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="Gábor Gincsai">
      
      
        <link rel="canonical" href="https://webportalok.github.io/webportalok/seminar/2%20-%20Projekt%20struktura/">
      
      
        <link rel="prev" href="../1%20-%20Tervezes/">
      
      
        <link rel="next" href="../3%20-%20Backend%20services/">
      
      
        
      
      
      <link rel="icon" href="../../favicon.ico">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>2. Project struktúra és adatmodell - VIAUJV83 - Webportálok fejlesztése</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../css/timeago.css">
    
      <link rel="stylesheet" href="../../extra-material-theme.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  <link href="../../assets/stylesheets/glightbox.min.css" rel="stylesheet"><script src="../../assets/javascripts/glightbox.min.js"></script><style id="glightbox-style">
            html.glightbox-open { overflow: initial; height: 100%; }
            .gslide-title { margin-top: 0px; user-select: text; }
            .gslide-desc { color: #666; user-select: text; }
            .gslide-image img { background: white; }
            .gscrollbar-fixer { padding-right: 15px; }
            .gdesc-inner { font-size: 0.75rem; }
            body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color); }
            body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color); }
            body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color); }
        </style></head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="aut" data-md-color-primary="aut" data-md-color-accent="red">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#2-project-struktura-es-adatmodell" class="md-skip">
          Kihagyás
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Élőfej">
    <a href="../.." title="VIAUJV83 - Webportálok fejlesztése" class="md-header__button md-logo" aria-label="VIAUJV83 - Webportálok fejlesztése" data-md-component="logo">
      
  <img src="../../logo-bme-aut.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            VIAUJV83 - Webportálok fejlesztése
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              2. Project struktúra és adatmodell
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="aut" data-md-color-primary="aut" data-md-color-accent="red" aria-label="Váltás sötét témára" type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Váltás sötét témára" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7M9 21v-1h6v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1m3-17a5 5 0 0 0-5 5c0 2.05 1.23 3.81 3 4.58V16h4v-2.42c1.77-.77 3-2.53 3-4.58a5 5 0 0 0-5-5"></path></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="red" data-md-color-accent="indigo" aria-label="Váltás világos témára" type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Váltás világos témára" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9z"></path></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Keresés" placeholder="Keresés" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
      </label>
      <nav class="md-search__options" aria-label="Keresés">
        
        <button type="reset" class="md-search__icon md-icon" title="Törlés" aria-label="Törlés" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Keresés inicializálása
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/webportalok/webportalok" title="Főoldalra ugrás" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"></path></svg>
  </div>
  <div class="md-source__repository">
    webportalok
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Lapok" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../information/terms%20of%20use/" class="md-tabs__link">
          
  
  
  Tudnivalók

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../0%20-%20Adatbazis%20alapok/" class="md-tabs__link">
          
  
  
  Laborok

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../homework/01%20-%20Specifikacio/" class="md-tabs__link">
          
  
  
  Házi feladatok

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigáció" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="VIAUJV83 - Webportálok fejlesztése" class="md-nav__button md-logo" aria-label="VIAUJV83 - Webportálok fejlesztése" data-md-component="logo">
      
  <img src="../../logo-bme-aut.png" alt="logo">

    </a>
    VIAUJV83 - Webportálok fejlesztése
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/webportalok/webportalok" title="Főoldalra ugrás" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"></path></svg>
  </div>
  <div class="md-source__repository">
    webportalok
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1">
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Tudnivalók
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Tudnivalók
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../information/terms%20of%20use/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Felhasználási feltételek
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../information/course/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Tárgy információk
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../information/requirements/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Házi feladat követelmények
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../information/contributing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Hozzájárulás az anyaghoz
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Laborok
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Laborok
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../0%20-%20Adatbazis%20alapok/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    MS SQL ADATBÁZIS ÉS EF ALAPOK
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../1%20-%20Tervezes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    1. Tervezés
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    2. Project struktúra és adatmodell
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    2. Project struktúra és adatmodell
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Tartalomjegyzék">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Tartalomjegyzék
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#webes-projekt-tipusok-attekintese" class="md-nav__link">
    <span class="md-ellipsis">
      
        Webes projekt típusok áttekintése
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#architektura" class="md-nav__link">
    <span class="md-ellipsis">
      
        Architektúra
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Architektúra">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#server-oldali-rendereles" class="md-nav__link">
    <span class="md-ellipsis">
      
        Server oldali renderelés
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kliens-oldali-rendereles" class="md-nav__link">
    <span class="md-ellipsis">
      
        Kliens oldali renderelés
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#kozos-backend-resz-kialakitasa" class="md-nav__link">
    <span class="md-ellipsis">
      
        Közös backend rész kialakítása
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Közös backend rész kialakítása">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#data-access-layer" class="md-nav__link">
    <span class="md-ellipsis">
      
        Data Access Layer
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Data Access Layer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#wireupcs-bevezetese" class="md-nav__link">
    <span class="md-ellipsis">
      
        Wireup.cs bevezetése
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#db-diagram-keszitese" class="md-nav__link">
    <span class="md-ellipsis">
      
        DB diagram készítése
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kezdeti-adatfeltoltes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Kezdeti adatfeltöltés
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dto-k-keszitese" class="md-nav__link">
    <span class="md-ellipsis">
      
        DTO-k készítése
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bll-service-ek-megvalositasa" class="md-nav__link">
    <span class="md-ellipsis">
      
        BLL service-ek megvalósítása
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BLL service-ek megvalósítása">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#automapper" class="md-nav__link">
    <span class="md-ellipsis">
      
        AutoMapper
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wireupcs" class="md-nav__link">
    <span class="md-ellipsis">
      
        Wireup.cs
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#console-app-letrehozasa" class="md-nav__link">
    <span class="md-ellipsis">
      
        Console App létrehozása
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Console App létrehozása">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#irequestservice-keszitese" class="md-nav__link">
    <span class="md-ellipsis">
      
        IRequestService készítése
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testmycode-szolgaltatas" class="md-nav__link">
    <span class="md-ellipsis">
      
        TestMyCode szolgáltatás
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aspnet-identity-tablak-letrehozasa" class="md-nav__link">
    <span class="md-ellipsis">
      
        ASP.NET Identity táblák létrehozása
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#teljes-dal-reteg" class="md-nav__link">
    <span class="md-ellipsis">
      
        Teljes DAL réteg
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../3%20-%20Backend%20services/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    3. Kiinduló Backend
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_5">
        
          
          <label class="md-nav__link" for="__nav_2_5" id="__nav_2_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    4. ASP.NET Razor Pages
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    4. ASP.NET Razor Pages
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../4%20-%20ASP.NET%20Razor%20Pages/4.1%20Basics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    4.1. Projekt felépítése és alapok
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../4%20-%20ASP.NET%20Razor%20Pages/4.2%20Main%20pages/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    4.2. Főbb oldalak létrehozása
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../4%20-%20ASP.NET%20Razor%20Pages/4.3%20Felhasznalokezeles/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    4.3. Felhasználó kezelés
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../4%20-%20ASP.NET%20Razor%20Pages/4.4%20Admin%20pages/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    4.4. Admin oldalak
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_6">
        
          
          <label class="md-nav__link" for="__nav_2_6" id="__nav_2_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    ASP.NET MVC
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    ASP.NET MVC
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../5%20-%20ASP.NET%20MVC/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    5. ASP.NET Core MVC
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_7">
        
          
          <label class="md-nav__link" for="__nav_2_7" id="__nav_2_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    6. Blazor WASM
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    6. Blazor WASM
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../6%20-%20Blazor%20WASM/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    6.1. Blazor WASM alapok
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3">
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Házi feladatok
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Házi feladatok
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../homework/01%20-%20Specifikacio/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Specifikáció készítése
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../homework/02%20-%20Nagy%20hazi%20feladat/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Nagyházi feladat készítése
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Tartalomjegyzék">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Tartalomjegyzék
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#webes-projekt-tipusok-attekintese" class="md-nav__link">
    <span class="md-ellipsis">
      
        Webes projekt típusok áttekintése
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#architektura" class="md-nav__link">
    <span class="md-ellipsis">
      
        Architektúra
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Architektúra">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#server-oldali-rendereles" class="md-nav__link">
    <span class="md-ellipsis">
      
        Server oldali renderelés
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kliens-oldali-rendereles" class="md-nav__link">
    <span class="md-ellipsis">
      
        Kliens oldali renderelés
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#kozos-backend-resz-kialakitasa" class="md-nav__link">
    <span class="md-ellipsis">
      
        Közös backend rész kialakítása
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Közös backend rész kialakítása">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#data-access-layer" class="md-nav__link">
    <span class="md-ellipsis">
      
        Data Access Layer
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Data Access Layer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#wireupcs-bevezetese" class="md-nav__link">
    <span class="md-ellipsis">
      
        Wireup.cs bevezetése
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#db-diagram-keszitese" class="md-nav__link">
    <span class="md-ellipsis">
      
        DB diagram készítése
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kezdeti-adatfeltoltes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Kezdeti adatfeltöltés
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dto-k-keszitese" class="md-nav__link">
    <span class="md-ellipsis">
      
        DTO-k készítése
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bll-service-ek-megvalositasa" class="md-nav__link">
    <span class="md-ellipsis">
      
        BLL service-ek megvalósítása
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BLL service-ek megvalósítása">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#automapper" class="md-nav__link">
    <span class="md-ellipsis">
      
        AutoMapper
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wireupcs" class="md-nav__link">
    <span class="md-ellipsis">
      
        Wireup.cs
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#console-app-letrehozasa" class="md-nav__link">
    <span class="md-ellipsis">
      
        Console App létrehozása
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Console App létrehozása">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#irequestservice-keszitese" class="md-nav__link">
    <span class="md-ellipsis">
      
        IRequestService készítése
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testmycode-szolgaltatas" class="md-nav__link">
    <span class="md-ellipsis">
      
        TestMyCode szolgáltatás
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aspnet-identity-tablak-letrehozasa" class="md-nav__link">
    <span class="md-ellipsis">
      
        ASP.NET Identity táblák létrehozása
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#teljes-dal-reteg" class="md-nav__link">
    <span class="md-ellipsis">
      
        Teljes DAL réteg
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
    <a href="https://github.com/webportalok/webportalok/edit/master/docs/seminar/2 - Projekt struktura/index.md" title="Oldal szerkesztése" class="md-content__button md-icon" rel="edit">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"></path></svg>
    </a>
  
  


<h1 id="2-project-struktura-es-adatmodell">2. Project struktúra és adatmodell<a class="headerlink" href="#2-project-struktura-es-adatmodell" title="Permanent link">¶</a></h1>
<h2 id="webes-projekt-tipusok-attekintese">Webes projekt típusok áttekintése<a class="headerlink" href="#webes-projekt-tipusok-attekintese" title="Permanent link">¶</a></h2>
<p>Mielőtt létrehozzuk a Razor Page projektünket tekintsük át, hogy milyen webes projekteket hozhatunk létre.</p>
<p>Igen sokféle kiinduló webes projekt közül választhatunk. Többek között szerver vagy kliens oldalon renderelt alkalmazást, üres template-et, vagy csak egy API projektet.</p>
<ul>
<li><strong>ASP.NET Core Web App (Razor Pages)</strong>: Szerver oldalon renderelt alkalmazás, ahol a View és Controller nem különül el, hanem egy Razor fájlban szerepel a View és előre meghatározott eseményekre feliratkozva tudunk az interakciókra reagálni.</li>
<li><strong>ASP.NET Core Web App (Model-View-Controller)</strong>: Szerver oldalon renderelt klasszikus Model-View-Controller architektúra alapú kiinduló projektet hoz létre.</li>
<li><strong>ASP.NET Core Web API</strong>: Kiinduló projekt RESTful API készítéshez. Itt nincs megjelenítési réteg csak a Controller-ek, amit egy különálló UI réteg amit egy SPA (pl: Blazor, Angular, React kliens) tud hívni.</li>
<li><strong>ASP.NET Core Empty</strong>: Teljesen üres project.</li>
<li><strong>Blazor Web App</strong>: Kliens oldalon renderelt alkalmazás, ahol a kliens a szerver által kipublikált REST API (Web API) végpontokat hívja. Ez az opció létre hozza a kliens oldali WASM és a szerver oldali API alkalmazást is.</li>
<li><strong>Blazor WebAssembly Standalone App</strong>: Ez is egy Blazor web assembly alkalmazást hoz létre, mint a Blazor Web App, viszont ez a szerver oldali projektet nem hozza létre.</li>
<li><strong>Blazor Server app</strong>: Szerver oldalon renderelt Blazor alkalmazás, ahol a kliens és a szerver SignalR-en keresztül kommunikál. Az eseményeket a szerver kezeli, a szerver HTML-t renderel és a renderelt HTML-t SignalR-en keresztül küldi el a kliensnek, hogy az meg tudja jeleníteni.</li>
</ul>
<h2 id="architektura">Architektúra<a class="headerlink" href="#architektura" title="Permanent link">¶</a></h2>
<p>Az alkalmazásunkban a felelősségek szétválasztása (separation of concerns) érdekében jellemzően rétegezett architektúrát használunk. Ez azt jelenti, hogy a kódot nem egyetlen projektbe szervezzük, hanem a logikailag különálló részeknek önálló projektet szánunk.
A legegyszerűbb megközelítés, ami kis méretű projektnél még működik, hogy két réteget használunk, melyben az adatkezelési réteg és az üzleti logika olyan közel állnak egymáshoz, így nem szeparáljuk őket külön rétegbe.
Közepes méretű projekteknél, ha klasszikus CRUD műveleteket végző alkalmazásról van szó, érdemes a BLL (üzleti logika) és DAL (adatelérés) kettéválasztása, emellett még létrehozhatunk különböző integrációkat megvalósító rétegeket, vagy összefüggő funkcióhalmazok (feature-ök) alapján függőleges vágással tovább szépíthetjük az architektúrát. További projektjeink lehetnek cross-cutting concern-eket megvalósító, nem réteges elrendezésű projektek, mint például a naplózás vagy auditálás megvalósításai, vagy ún. absztrakciós projektek, amikben alkalmazásunk publikus interfészeit, absztrakt osztályait, megosztott osztályait, tehát csak az API-ját definiáljuk.
Ha az üzleti logikai réteget is leválasztjuk, plusz (legalább) egy transzformációs logikát illik implementálni, ami az entitásokat a web számára emészthető formába transzformálja.</p>
<p>Az alkalmazást klasszikus többrétegű architektúrában valósítjuk meg.</p>
<ul>
<li><strong>UI</strong>: A felhasználói felültet magába foglaló réteg. Attól függ, hogy milyen technológiát választunk.  <ul>
<li>ASP.NET MVC és Razor page esetén (szerver oldali renderelés) a konkrét HTML oldalt jelenti.</li>
<li>Blazor esetén (kliens oldali renderelés) a kliens oldali kódot jelenti, de ilyen esetben megjelenik egy Web API réteg is, amit HTTP-n keresztül a kliens tud hívni.</li>
</ul>
</li>
<li><strong>Business Logic (BLL)</strong>: Az alkalmazás üzleti logikai rétegbe. Ez a réteg kérdezi le EF segítségével az adatokat az  adatbázisból és adja vissza a hívó rétegnek az adatokat miután DTO-kra konvertálta.</li>
<li><strong>Data Access (DAL)</strong>: Az adatbázis Entity Framework rétegét tartalmazza. Itt találhatók az adatbázis entitások, a DbContext és migrációk.</li>
<li><strong>Transfer (DTO)</strong>: DTO-kat tartalmazó projekt, nem külön réteg.</li>
<li><strong>Server.Abstraction</strong>: Interfészek, amiket később meg kell valósítani, és DI-al betölteni. Az egyes projektek az interfész alapján így tudják használni a konkrét implementáció ismerete nélkül is.</li>
</ul>
<h3 id="server-oldali-rendereles">Server oldali renderelés<a class="headerlink" href="#server-oldali-rendereles" title="Permanent link">¶</a></h3>
<p>ASP.NET MVC vagy Razor Page esetén a szerver állítja elő a HTML tartalmat, amit a böngészőnek csak meg kell jeleníteni. Ilyen esetben kliens oldalon minimális JavaScript kód található.</p>
<figure>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="images/Bookshop_architektura_server.png" data-desc-position="bottom"><img alt="Szerver architektúra" src="images/Bookshop_architektura_server.png"></a></p>
<figcaption>
<p>Szerver oldali renderelés architektúrája</p>
</figcaption>
</figure>
<p>Mint a fenti ábrán is látható, nincs érdemi Frontend kód, hiszen a kliens oldalra HTML kód kerül leküldésre, amit csak meg kell jeleníteni. A kliens oldali interaciókhoz nincs speciális támogatás, azt csak JavaScript segítségével tudjuk megvalósítani.
Esetleg <a href="https://jquery.com/">jQuery</a> és <a href="https://jqueryui.com/">jQuery UI</a>-t tudunk még erre használni.</p>
<h3 id="kliens-oldali-rendereles">Kliens oldali renderelés<a class="headerlink" href="#kliens-oldali-rendereles" title="Permanent link">¶</a></h3>
<p>Blazor Web Assembly esetén, a kód egy része (UI réteg) a kliensen fut így backend oldalon szükség van egy Web API rétegre, amit a kliens meg tud hívni az adatok letöltéséhez.</p>
<ul>
<li>Első oldal betöltéskor letöltődik az alkalmazás kódja a kliensre</li>
<li>Ezt követően a kliens aszinkron kérésekkel tölti le a szükséges adatokat, amit aztán megjelenít a felületen.</li>
</ul>
<figure>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="images/Bookshop_architektura_client.png" data-desc-position="bottom"><img alt="Kliens architektúra" src="images/Bookshop_architektura_client.png"></a></p>
<figcaption>
<p>Kliens oldali renderelés architektúrája</p>
</figcaption>
</figure>
<p>Figyeljük meg, hogy a kliens és szerver között JSON-ban utaznak a DTO (Data Transfer Object) osztályok. Blazor esetén a kliens és szerver oldali kód is C#-ban készül így a DTO-kat magába foglaló Transfer projektre a kliens és a szerver is tartalmaz referenciát, tehát nincs szükség a szerver oldali DTO-k generálására kliens oldalon. (React és Angular esetén ez szükséges lenne, hiszen ott a kliens oldali programozási nyelv a JS / TS, így a DTO-kat is azon a nyelven kell megvalósítani.)</p>
<h2 id="kozos-backend-resz-kialakitasa">Közös backend rész kialakítása<a class="headerlink" href="#kozos-backend-resz-kialakitasa" title="Permanent link">¶</a></h2>
<p>Ahogy a fenti architektúra ábrákon is látszik mindkét megközelítés esetén a <em>Business Logic</em> és a <em>Data Access</em> réteg lehet közös, sőt a DTO-kat tartalmazó <em>Transfer</em> projekt is, de a példában külön projektekben valósítjuk meg ezeket a rétegeket.</p>
<p>Ha az alkalmazásunk több projektből áll, akkor a projekteket egy ún. solution fogja össze, amely egy logikai egységet ad a projektek köré. Alapvetően a projekt egy egységnyi, egyértelmű kimenettel rendelkező kódhalmaz, például egy szerelvény (.exe, .dll saját függőségeivel) vagy website (.dll-ek, statikusan kiszolgálandó fájlok stb). Az egy solution-ben levő projektek tehát egy nagyobb probléma megoldásáért felelős nagyobb építőkockák.</p>
<ol>
<li>
<p>Hozzunk létre a <code>BookShop.Dal</code> projektet. Ehhez válasszuk a <code>File → New → Projekt / Solution</code> opciót, majd a felugró ablakban adjuk meg a szükséges adatokat.</p>
<ul>
<li>Project típusa: Class Library</li>
<li>Project neve: BookShop.Dal</li>
<li>Solution neve: BookShop</li>
<li>Framework: .NET 10</li>
</ul>
<details class="info">
<summary>Segítség - Képernyőképek a projekt létrehozásról</summary>
<figure>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="images/Create-Dal-1.png" data-desc-position="bottom"><img alt="New Project 1" src="images/Create-Dal-1.png"></a></p>
<figcaption>
<p>Új projekt létrehozása 1.</p>
</figcaption>
</figure>
<figure>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="images/Create-Dal-2.png" data-desc-position="bottom"><img alt="New Project 2" src="images/Create-Dal-2.png"></a></p>
<figcaption>
<p>Új projekt létrehozása 2.</p>
</figcaption>
</figure>
<figure>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="images/Create-Dal-3.png" data-desc-position="bottom"><img alt="New Project 3" src="images/Create-Dal-3.png"></a></p>
<figcaption>
<p>Új projekt létrehozása 3.</p>
</figcaption>
</figure>
</details>
</li>
<li>
<p>Ezt követően létrejön a solution és benne a projekt is, ahogy azt a <em>Solution Explorer</em> ablakban láthatjuk.</p>
<details class="success" open="open">
<summary>A létrejött solution és project</summary>
<figure>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="images/Solution-Dal-1.png" data-desc-position="bottom"><img alt="Solution 1" src="images/Solution-Dal-1.png"></a></p>
<figcaption>
<p>A létrejött solution és projekt</p>
</figcaption>
</figure>
</details>
</li>
<li>
<p>Adjuk hozzá a solution-höz a <code>BoohShop.Bll</code> projektet is. Ehhez jobb gombbal kattintsunk a Solution-re, majd válasszuk az <code>Add → New Project</code> opciót, és adjuk meg a projekt adatait.</p>
<details class="info">
<summary>Segítség - Képernyőképek az új projekt hozzáadásáról</summary>
<figure>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="images/Add-New-Project.png" data-desc-position="bottom"><img alt="Add new project 1" src="images/Add-New-Project.png"></a></p>
<figcaption>
<p>Új projekt hozzáadása</p>
</figcaption>
</figure>
<figure>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="images/Add-New-Project-2.png" data-desc-position="bottom"><img alt="Add new project 2" src="images/Add-New-Project-2.png"></a></p>
<figcaption>
<p>Új projekt hozzáadása 2.</p>
</figcaption>
</figure>
</details>
</li>
<li>
<p>A fentihez hasonló módon vegyük fel a <code>BookShop.Transfer</code> projektet is.</p>
</li>
<li>
<p>Adjuk referenciát a <code>BookShop.Bll</code> projektből a <code>BookShop.Dal</code> és <code>BookShop.Transfer</code> projektekre.</p>
<details class="info">
<summary>Segítség - Képernyőképek a projekt referencia hozzadásáról</summary>
<figure>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="images/Add-reference-1.png" data-desc-position="bottom"><img alt="Add reference 1" src="images/Add-reference-1.png"></a></p>
<figcaption>
<p>Projekt refererencia hozzáadása</p>
</figcaption>
</figure>
<figure>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="images/Add-reference-2.png" data-desc-position="bottom"><img alt="Add reference 2" src="images/Add-reference-2.png"></a></p>
<figcaption>
<p>Projektek kiválasztása és hozzáadás</p>
</figcaption>
</figure>
</details>
</li>
</ol>
<h3 id="data-access-layer">Data Access Layer<a class="headerlink" href="#data-access-layer" title="Permanent link">¶</a></h3>
<p>A projekt struktúra elkészítése után nekifoghatunk a legalsó réteg megvalósításához.</p>
<ol>
<li>A projekten vagy a projekt alatti Dependencies elemen jobb klikkelve a <code>Manage NuGet Packages...</code> telepíthetünk NuGet csomagokat.</li>
<li>
<p>A Browse tab-on adjuk meg a csomag nevét <code>Microsoft.EntityFrameworkCore.SqlServer</code>, válasszuk ki a listából, ellenőrizzük a verziószámot, majd installáljuk a projekthez!</p>
<details class="info">
<summary>Segítség - Képernyőképek a NuGet package hozzadásáról</summary>
<figure>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="images/Add-nuget-ef.png" data-desc-position="bottom"><img alt="Add NuGet EF 2" src="images/Add-nuget-ef.png"></a></p>
<figcaption>
<p>NuGet package hozzáadása egy projekthez</p>
</figcaption>
</figure>
</details>
</li>
<li>
<p>A telepítés megkezdése előtt meg kell erősítenünk, hogy a szükséges módosításokat végrehajthatja és el kell fogadni a felhasználási feltételeket.</p>
</li>
<li>Törölhetjük a kiinduláskor létrejött <code>Class1.cs</code> fájlt.</li>
<li>
<p>Hozzunk létre egy <code>Entities</code> mappát, benne a <code>Book.cs</code> osztállyal! Ennek tartalma az alábbi:</p>
<div class="highlight"><span class="filename">Book.cs</span><pre><span></span><code><span class="hll"><span class="k">namespace</span><span class="w"> </span><span class="nn">BookShop.Dal.Entities</span><span class="p">;</span>
</span>
<span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Book</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">Id</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="hll"><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">Title</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">null</span><span class="o">!</span><span class="p">;</span>
</span><span class="hll"><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">Author</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">null</span><span class="o">!</span><span class="p">;</span>
</span><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">string?</span><span class="w"> </span><span class="n">Subtitle</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">string?</span><span class="w"> </span><span class="n">ShortDescription</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">decimal</span><span class="w"> </span><span class="n">Price</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">decimal?</span><span class="w"> </span><span class="n">DiscountedPrice</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">PublishYear</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">PageNumber</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</li>
<li>
<p>Figyeljük meg a fenti kódban az alábbiakat</p>
<ul>
<li>Nincs az osztályban külön using rész, mert csak olyan névtereket használunk amik globálisan using-olva vannak.</li>
<li>A namespace után nincs kapcsoszárójel, hanem <code>;</code> szerepel, így csökkentve a kódbehúzást.</li>
<li>A <code>Title</code> és <code>Author</code> mezők nem lehetnek üresek, így a property végén szerepel az <code>= null!</code>
   Ha nem szerepelne ott a <code>= null!</code> warning-ot kapnánk rá, mert a projekten alapértelmezés szerint engedélyezve van a referencia szerinti null-ok kezelése.
   A projekt fájlban a <code>&lt;Nullable&gt;enable&lt;/Nullable&gt;</code> sor engedélyezi.
   A null-forgiving operator (!) segítségével beállítjuk null-ra úgy, hogy ne szóljon érte a fordító. Navigation property-k esetén ez a javasolt megoldás.</li>
<li>Vagy készítsünk hozzá egy konstruktort, ami várja a Title-t és beállítja. Egyszerű property-k esetén ez a javasolt megoldás. De bizonyos estekben ez nehézséget okoz, mert nem tudjuk a default konstruktort használni, így általában a <code>null!</code>-es megoldást szoktuk használni.</li>
</ul>
</li>
<li>
<p>A fentihez hasonlóan hozzuk létre a <code>Category.cs</code> entitást is.</p>
<div class="highlight"><span class="filename">Category.cs</span><pre><span></span><code><span class="k">namespace</span><span class="w"> </span><span class="nn">BookShop.Dal.Entities</span><span class="p">;</span>

<span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Category</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">Id</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">Name</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">null</span><span class="o">!</span><span class="p">;</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">string?</span><span class="w"> </span><span class="n">Order</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">int?</span><span class="w"> </span><span class="n">ParentCategoryId</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Navigation properties</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">virtual</span><span class="w"> </span><span class="n">Category</span><span class="o">?</span><span class="w"> </span><span class="n">ParentCategory</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">virtual</span><span class="w"> </span><span class="n">ICollection</span><span class="o">&lt;</span><span class="n">Book</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Books</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">virtual</span><span class="w"> </span><span class="n">ICollection</span><span class="o">&lt;</span><span class="n">Category</span><span class="o">&gt;</span><span class="w"> </span><span class="n">ChildCategories</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>
<span class="p">}</span>
</code></pre></div>
</li>
<li>
<p>Vegyünk fel a projekt gyökerébe egy <code>BookShopDbContext.cs</code> fájlt a lentebbi tartalommal!</p>
<div class="highlight"><span class="filename">BookShopDbContext.cs</span><pre><span></span><code><span class="k">using</span><span class="w"> </span><span class="nn">BookShop.Dal.Entities</span><span class="p">;</span>
<span class="k">using</span><span class="w"> </span><span class="nn">Microsoft.EntityFrameworkCore</span><span class="p">;</span>

<span class="k">namespace</span><span class="w"> </span><span class="nn">BookShop.Dal</span><span class="p">;</span>

<span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">BookShopDbContext</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">DbContext</span><span class="w"> </span>
<span class="p">{</span><span class="w"> </span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="nf">BookShopDbContext</span><span class="p">(</span><span class="n">DbContextOptions</span><span class="w"> </span><span class="n">options</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="k">base</span><span class="p">(</span><span class="n">options</span><span class="p">)</span><span class="w"> </span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="p">}</span><span class="w"> </span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">DbSet</span><span class="o">&lt;</span><span class="n">Book</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Books</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">DbSet</span><span class="o">&lt;</span><span class="n">Category</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Categories</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</li>
<li>
<p>Ha kézzel hozzuk létre az osztályt, a <code>using</code>-okat később szoktuk a kódba helyezni, amikor hivatkozás történik rájuk, ehhez a <span class="keys"><kbd class="key-control">Ctrl</kbd><span>+</span><kbd class="key-period">.</kbd></span> billentyűket vagy a bal oldali sárga villanykörtét tudjuk használni.</p>
</li>
<li>
<p>A fenti kódot tudjuk még tömörebben írni a <code>primary constructor</code> használatával. Ehhez kattintsunk a sor elején található lámpa ikonra, vagy a konstruktor neve alatt lévő ... részre.</p>
<details class="tip" open="open">
<summary>Quick actions - Primary constructor</summary>
<figure>
<p>A primary constructort érdemes használni egyszerűbb osztályoknál, a tömörebb kód érdekében.
Részletesen: <a href="https://learn.microsoft.com/en-us/dotnet/csharp/whats-new/tutorials/primary-constructors">primary constructor</a>
<a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="images/Quick-actions.png" data-desc-position="bottom"><img alt="Quick actions" src="images/Quick-actions.png"></a></p>
<figcaption>
<p>Quick actions</p>
</figcaption>
</figure>
</details>
</li>
<li>
<p>Így a fenti kódunk még tömörebb lett.</p>
<div class="highlight"><span class="filename">BookShopDbContext.cs</span><pre><span></span><code><span class="hll"><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nf">BookShopDbContext</span><span class="p">(</span><span class="n">DbContextOptions</span><span class="w"> </span><span class="n">options</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">DbContext</span><span class="p">(</span><span class="n">options</span><span class="p">)</span><span class="w"> </span>
</span><span class="p">{</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">DbSet</span><span class="o">&lt;</span><span class="n">Book</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Books</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">DbSet</span><span class="o">&lt;</span><span class="n">Category</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Categories</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</li>
<li>
<p>Az osztály konstruktorában egy <code>DbContextOptions</code> példányt vár, ami az adatbázis-kapcsolat konfigurációs beállításait (timeout, connection string) tartalmazza. Ezt később konfiguráljuk fel.
Ez az osztály, és a benne található <code>DbSet&lt;T&gt;</code> példányok megvalósítják az ún. repository mintát. A minta gyakorlatilag távoli objektumok proxy-zását, esetleges cache-elését valósítja meg a CRUD műveletek elérhetővé tételével.<br>
Az utóbbi időszakban egyre trendibb lett (sajnos) plusz egy repository réteg felépítése az EF réteg fölé, ezt a megközelítést erősen ellenjavalljuk (kódkarbantarthatósági, teljesítménybeli és architektúrális okokból). Egy <code>DbContext</code> példányt használva mi magunk valósítjuk meg a Unit of work mintát, a példány létrejötte és az egyes <code>SaveChanges</code> hívások között egy egységnyi munka történik.<br>
A <code>DbContext</code> megvalósítja az <code>IDisposable</code> interfészt, tehát van saját <code>Dispose</code> metódusa, mely az adatbázis kapcsolat bontásáért felelős. Ha nem <code>DI</code> segítségével adjuk át a megfelelő példányt hanem kézzel hozzuk létre (ami nem javasolt), akkor mindig <code>using</code> vagy <code>try-(catch-)finally</code> blokkban használjuk a <code>DbContext</code> példányokat, mert így garantálható csak a drága adatbáziskapcsolatok megszüntetése, amikor már nincsen rájuk tovább szükség!</p>
</li>
<li>A séma megadásához Code First megközelítést használunk (tehát a DB modelljét .NET kódban adjuk meg), az adatbázis sémájának karbantartásához pedig a keretrendszer által támogatott ún. migrációkat használunk.</li>
<li>Ahhoz, hogy a migrációkat létre tudjuk hozni induló projekt nélkül szükséges egy <code>IDesignTimeDbContextFactory</code> implementálása.</li>
<li>Készítsük el a <code>BookShop.Dal</code> projektben a saját <code>IDesignTimeDbContextFactory</code> implementációnkat. Ez az ideiglenes megoldás arra jó, hogy ki tudjuk próbálni a migrációt, a nélkül hogy további rétegeket vennénk fel.</li>
<li>
<p>Hozzuk létre a <code>BookShopDbContextFactory</code> osztályt az alábbi implementációval.</p>
<div class="highlight"><span class="filename">BookShopDbContextFactory.cs</span><pre><span></span><code><span class="k">using</span><span class="w"> </span><span class="nn">Microsoft.EntityFrameworkCore</span><span class="p">;</span>
<span class="k">using</span><span class="w"> </span><span class="nn">Microsoft.EntityFrameworkCore.Design</span><span class="p">;</span>

<span class="k">namespace</span><span class="w"> </span><span class="nn">BookShop.Dal</span><span class="p">;</span>

<span class="hll"><span class="k">internal</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">BookShopDbContextFactory</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">IDesignTimeDbContextFactory</span><span class="o">&lt;</span><span class="n">BookShopDbContext</span><span class="o">&gt;</span>
</span><span class="p">{</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">BookShopDbContext</span><span class="w"> </span><span class="nf">CreateDbContext</span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">optionsBuilder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DbContextOptionsBuilder</span><span class="o">&lt;</span><span class="n">BookShopDbContext</span><span class="o">&gt;</span><span class="p">();</span>
<span class="hll"><span class="w">        </span><span class="n">optionsBuilder</span><span class="p">.</span><span class="n">UseSqlServer</span><span class="p">(</span><span class="s">"Data Source=.;Initial Catalog=BookShopDb;Integrated Security=True;TrustServerCertificate=True"</span><span class="p">);</span>
</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">BookShopDbContext</span><span class="p">(</span><span class="n">optionsBuilder</span><span class="p">.</span><span class="n">Options</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</li>
<li>
<p>Figyeljük meg, hogy az osztály <code>internal</code> hiszen nem szeretnénk máshonnan elérni. Ezen felül ennek a megoldásnak a hátrányát is vegyük észre, hiszen itt az adatbázis kapcsolódási sztringet bele kellett írni a kódba, nem konfigurációból olvassuk fel!
Ezen felül az SQL kapcsolódási sztringben szerepel egy <code>TrustServerCertificate=True</code> ami azt jelzi, hogy a szerver SSL tanúsítványát fogadja el akkor is, ha az nem érvényes.</p>
</li>
<li>
<p>A migráció automatizált létrehozására két lehetőségünk van: <code>PowerShell</code> vagy a platform független <code>.NET Core CLI</code> (Command Line Interface), ami a <code>dotnet ef</code> parancs (ezt érdemes global package-ként telepíteni, ha ezt szeretnénk használni).
Számunkra egyszerűbb most az első megoldás, ezért nyissuk meg a <code>Package Manager Console</code>-t (View → Other Windows → Package Manager Console), és adjuk ki az alábbi parancsot (közben ügyeljünk, hogy a Default projekt a <code>BookShop.Dal</code> legyen!):</p>
<details class="info">
<summary>Hol találom a Package Manager Console ablakot?</summary>
<figure>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="images/Package-manager-console.png" data-desc-position="bottom"><img alt="Package manager console" src="images/Package-manager-console.png"></a></p>
<figcaption>
<p>Package Manager Console megnyitása</p>
</figcaption>
</figure>
</details>
<p>Ahhoz, hogy ki tudjuk adni az Add-Migration parancsot, fel kell telepíteni a <code>Microsoft.EntityFrameworkCore.Tools</code> nuget packaget a DAL projekthez</p>
</li>
<li>
<p>A <code>Package Manager Console</code>-ból adjuk ki a parancsot, ami legenerálja a kezdeti migrációt. Figyeljünk arra, hogy a Default project a <code>BookShop.Dal</code> legyen. Az átadott <code>Initial</code> paraméter egy szabadszöveges sting, mely a migrációnk nevét adja. Ez tehát a kiinduló (initial) migrációnk.</p>
<div class="highlight"><pre><span></span><code><span class="nb">Add-Migration</span> <span class="n">Initial</span>
</code></pre></div>
<details class="info">
<summary>Segítség - Hol találom a Package Manager Console ablakot?</summary>
<figure>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="images/package-manager-initial.png" data-desc-position="bottom"><img alt="Initial migration" src="images/package-manager-initial.png"></a></p>
<figcaption>
<p>Package Manager Console - kezdeti migráció létrehozása</p>
</figcaption>
</figure>
</details>
</li>
<li>
<p>Nézzük meg a solution explorer ablakban, hogy létrejöttek a migrációk.</p>
<details class="success" open="open">
<summary>Létrejöttek a migrációs fájlok</summary>
<figure>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="images/initial-migration-created.png" data-desc-position="bottom"><img alt="Initial migration created" src="images/initial-migration-created.png"></a></p>
<figcaption>
<p>A létrejött migrációs fájlok</p>
</figcaption>
</figure>
</details>
<p>A migrációs fájlokban (pl.: <code>Datum_Initial.cs</code>) jól értelmezhető, generált kódot találunk, amelyekben szükség esetén akár módosításokat is végezhetünk, és bár ez általánosságban nem jellemző, mindenképp tudni illik, mert előfordul, hogy kézi módosítást kell végeznünk ezekben a fájlokban. Ez építi fel a migrációhoz szükséges SQL parancsokat az alkalmazáshoz, tehát definiálja a sémát: táblákat, kulcsokat, megkötéseket stb.</p>
<figure>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="images/inital-migration-cs.png" data-desc-position="bottom"><img alt="Initial migration code" src="images/inital-migration-cs.png"></a></p>
<figcaption>
<p>A kezdeti migráció tartalma</p>
</figcaption>
</figure>
</li>
<li>
<p>Futtassuk le a migrációt, hogy létrejöjjön az adatbázis is.</p>
<div class="highlight"><pre><span></span><code><span class="nb">Update-Database</span>
</code></pre></div>
<details class="info">
<summary>Segítség - Képernyőkép az update-database futtatásáról</summary>
<figure>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="images/package-manager-console-db-migrate.png" data-desc-position="bottom"><img alt="DB migate" src="images/package-manager-console-db-migrate.png"></a></p>
<figcaption>
<p>Adatbázis migráció futtatása</p>
</figcaption>
</figure>
</details>
</li>
<li>
<p>Ezután megvizsgálhatjuk SQL Server Object Explorerben a létrejött sémát is.</p>
<details class="success" open="open">
<summary>Létrejött az adatbázis</summary>
<figure>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="images/created-DB.png" data-desc-position="bottom"><img alt="Created DB" src="images/created-DB.png"></a></p>
<figcaption>
<p>A létrejött adatbázis MS SQL Management studióban.</p>
</figcaption>
</figure>
</details>
<p>Érdemes észrevennünk, hogy az <code>Id</code> oszlophoz automatikusan DB-generált kulcs jön létre, pedig ezt nem fogalmaztuk meg sehol. Az EF konvenciókat használ nagyon sok sémával kapcsolatos művelethez, ilyen például az elsődleges kulcs kényszer is, amivel, ha egy entitásban egy <code>int</code> vagy <code>Guid</code> típusú, <code>ID</code>, <code>Id</code> vagy <code>&lt;Típus&gt;Id</code> nevű mezőt hozunk létre, az automatikus kulcsa lesz az adott táblának.
23. A migrációban láthatjuk, hogy egy <code>Up()</code> és egy <code>Down()</code> metódus kerül definiálásra. Az <code>Up()</code> metódusok lefuttatásával a keretrendszer olyan SQL kódot generál, amelyet egy korábbi (tehát üres) adatbázison lefuttatva a migráció állapotának megfelelő sémát hoz létre. A <code>Down()</code> futtatásával a korábbi állapotra tudunk visszaállni.
Figyeljük meg, hogy az adatbázisban is beállítja a <code>Book.cs</code>-ben megadott property-k típusa alapján, hogy az adott mező lehet-e null.</p>
<ul>
<li>A PublishYear típusa int így az kötelező mező, nem lehet null az értéke</li>
<li>A DiscountedPrice típusa decimal? ami viszont lehet null, ezért az adatbázis táblában is nullable-ként jön létre.</li>
<li>A Title string típusú és az adatbázisban not null-ként jön létre. De miért? A string lehet null. Vagy mégsem? Attól függ, hogy a Nullable reference type-okat használjuk vagy sem. A generált projekt alapértelmezés szerint használja, tehát a string nem lehet null. Ha meg szeretnénk engedni, hogy a sztring lehessen null, akkor string? -et kell használni, ahogy használtuk is a <code>Book.cs</code>-ben</li>
</ul>
</li>
</ol>
<h4 id="wireupcs-bevezetese">Wireup.cs bevezetése<a class="headerlink" href="#wireupcs-bevezetese" title="Permanent link">¶</a></h4>
<ol>
<li>Szebbé tehetjük a kódunkat, ha a DbContext regisztrálását a DAL rétegben valósítjuk meg egy extension metódusban, amit majd a későbbiekben tudunk hívni a BLL-ből.</li>
<li>
<p>Ehhez először a <code>BookShop.Dal</code> projekt gyökerében hozzunk létre egy <code>Wireup.cs</code>, amiben egy <code>AddBookShopDbContext</code> extension metódust definiálunk az alábbiak szerint.</p>
<div class="highlight"><span class="filename">Wireup.cs</span><pre><span></span><code><span class="k">using</span><span class="w"> </span><span class="nn">Microsoft.EntityFrameworkCore</span><span class="p">;</span>
<span class="k">using</span><span class="w"> </span><span class="nn">Microsoft.Extensions.Configuration</span><span class="p">;</span>
<span class="k">using</span><span class="w"> </span><span class="nn">Microsoft.Extensions.DependencyInjection</span><span class="p">;</span>

<span class="k">namespace</span><span class="w"> </span><span class="nn">BookShop.Dal</span><span class="p">;</span>

<span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Wireup</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">IServiceCollection</span><span class="w"> </span><span class="nf">AddBookShopDbContext</span><span class="p">(</span><span class="k">this</span><span class="w"> </span><span class="n">IServiceCollection</span><span class="w"> </span><span class="n">services</span><span class="p">,</span><span class="w"> </span><span class="n">IConfiguration</span><span class="w"> </span><span class="n">configuration</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// DB Context regisztrálása a DI containerbe.</span>
<span class="w">        </span><span class="n">services</span><span class="p">.</span><span class="n">AddDbContext</span><span class="o">&lt;</span><span class="n">BookShopDbContext</span><span class="o">&gt;</span><span class="p">(</span><span class="n">options</span><span class="w"> </span><span class="o">=&gt;</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">options</span><span class="p">.</span><span class="n">UseSqlServer</span><span class="p">(</span><span class="n">configuration</span><span class="p">.</span><span class="n">GetConnectionString</span><span class="p">(</span><span class="s">"DefaultConnection"</span><span class="p">));</span>
<span class="w">        </span><span class="p">});</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">services</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</li>
<li>
<p>Ezt a függvényt meghívva tudjuk majd a DbContext-et beregisztrálni úgy, hogy az adatbázis kapcsolódási sztringet a startup project appsettings.json fájl <code>DefaultConnection</code> értékéből olvassa ki.</p>
</li>
</ol>
<h4 id="db-diagram-keszitese">DB diagram készítése<a class="headerlink" href="#db-diagram-keszitese" title="Permanent link">¶</a></h4>
<ol>
<li>
<p>A későbbiekben a fejlesztést nagy mértékben segíti, ha az adatmodellről van egy diagramunk. Ezt úgy tudjuk létrehozni, hogy a <code>BoohShop.Dal/Entites</code> könyvtárhoz hozzáadunk egy új <code>Class Diagram</code> típusú elemet.</p>
<details class="info">
<summary>Segítség - Class diagram hozzáadása a projekthez</summary>
<figure>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="images/add-db-diagram.png" data-desc-position="bottom"><img alt="Add DB Diagram" src="images/add-db-diagram.png"></a></p>
<figcaption>
<p>Class diagram hozzáadása a projekthez.</p>
</figcaption>
</figure>
</details>
</li>
<li>
<p>Ezt követően húzzuk rá a diagramra a <code>Book</code> és <code>Category</code> entitásokat. Azonban ez még kevés, mert szeretnénk a "táblák" (valójában entitások) közötti kapcsolatokat is látni. Ehhez kattintunk jobb gombbal a <code>Category</code> entitás <code>ChildCategories</code> tulajdonságára, majd válasszuk a <code>Show as Collection Association</code>-t, hiszen egy egy lista. Ha nem lista lenne akkor a <code>Show as Assiciation</code> a megfelelő választás.</p>
<details class="info">
<summary>Segítség - Navigációs tulajdonságok mutatása kapcsolatként</summary>
<figure>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="images/db-show-as-assosication.png" data-desc-position="bottom"><img alt="Add DB Diagram" src="images/db-show-as-assosication.png"></a></p>
<figcaption>
<p>Class diagram hozzáadása a projekthez.</p>
</figcaption>
</figure>
</details>
</li>
<li>
<p>Állítsuk be a <code>ParentCategory</code>-ra és a <code>Books</code>-ra is, hogy kapcsolatként mutassa.</p>
<details class="success" open="open">
<summary>Elészült adat modell diagram</summary>
<figure>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="images/Db-diagram.png" data-desc-position="bottom"><img alt="Add DB Diagram" src="images/Db-diagram.png"></a></p>
<figcaption>
<p>Az elkészített adat modell diagram.</p>
</figcaption>
</figure>
</details>
</li>
<li>
<p>Így már van egy folyamatosan frissülő diagramunk a kódban, ahol áttekinthetjük a EF modellünket.</p>
</li>
</ol>
<h4 id="kezdeti-adatfeltoltes">Kezdeti adatfeltöltés<a class="headerlink" href="#kezdeti-adatfeltoltes" title="Permanent link">¶</a></h4>
<ol>
<li>
<p>Az alkalmazás kezdeti, ún. ősadatokkal történő feltöltését (seed) a keretrendszer segítségével oldjuk meg.
Ős adatokat a <code>DbContext.OnModelCreating</code> metódusának felüldefiniálásával, és a <code>ModelBuilder</code> fluent API használatával tudunk az alkalmazáshoz felvenni. Ehhez override-olnunk kell a megfelelő metódust a <code>BookShopDbContext</code>-ben.</p>
<div class="highlight"><span class="filename">BookShopDbContext.cs</span><pre><span></span><code><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nf">BookShopDbContext</span><span class="p">(</span><span class="n">DbContextOptions</span><span class="w"> </span><span class="n">options</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">DbContext</span><span class="p">(</span><span class="n">options</span><span class="p">)</span><span class="w"> </span>
<span class="p">{</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">DbSet</span><span class="o">&lt;</span><span class="n">Book</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Books</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">DbSet</span><span class="o">&lt;</span><span class="n">Category</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Categories</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="hll"><span class="w">    </span><span class="k">protected</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">OnModelCreating</span><span class="p">(</span><span class="n">ModelBuilder</span><span class="w"> </span><span class="n">modelBuilder</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span class="hll"><span class="w">        </span><span class="k">base</span><span class="p">.</span><span class="n">OnModelCreating</span><span class="p">(</span><span class="n">modelBuilder</span><span class="p">);</span>
</span>
<span class="w">        </span><span class="n">modelBuilder</span><span class="p">.</span><span class="n">Entity</span><span class="o">&lt;</span><span class="n">Book</span><span class="o">&gt;</span><span class="p">().</span><span class="n">HasData</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Book</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">Title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"Teszt könyv"</span><span class="p">,</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">});</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Base OnModelCreating meghívása</p>
<p>Fontos, hogy az ősosztály <code>OnModelCreating</code> metódusát is meghívjuk, mert ha leszármazunk később az IdentityDbContext-ből akkor ne hasaljon el a migráció készítése.</p>
</div>
</li>
<li>
<p>Fontos megemlíteni, hogy a fenti példához hasonlóan a HasData API-n keresztül mindig kötelező kitölteni az entitások elsődleges kulcsait! Ez azért lehet szokatlan, mert mesterséges kulcsok esetén (mint a <code>Book</code> esetében is) alapvetően az adatbázis feladata megadni egy elem ID-ját, ezért más helyen az <code>Id</code>-t az alapértelmezett <code>0</code> értéken fogjuk hagyni az üzleti logikában létrehozáskor, azt az adatbázis fogja kitölteni szekvencia alapján. Most azért kell megadnunk az ID-kat, mert ezek a kódban definiált entitások valójában úgy kezelendők, mintha az adatbázisban lennének megtalálhatók, tehát minden tulajdonságukat előre számítottuk és fixnek, determinisztikusnak kell lenniük. Ha nem determinisztikusak ezek az értékek, minden migráció generálásakor újra és újra be fognak szúródni az adatbázisba az entitások vagy hibára fogunk futni. Röviden tehát itt beégetett ID-kat kell használnunk.
A fenti API használatával nem csak ős adatokat, hanem egyéb metaadat-szintű konfigurációt is megadhatunk, például adattáblák nevét, oszlopok egyediségét, indexeket stb. Ezt az API-t a későbbiekben, a végleges adatmodell készítésekor fogjuk alaposabban megvizsgálni.</p>
</li>
<li>
<p>Töltsünk fel egy pár kezdeti könyvet az alábbi kóddal</p>
<div class="highlight"><span class="filename">BookShopDbContext.cs</span><pre><span></span><code><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nf">BookShopDbContext</span><span class="p">(</span><span class="n">DbContextOptions</span><span class="w"> </span><span class="n">options</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">DbContext</span><span class="p">(</span><span class="n">options</span><span class="p">)</span><span class="w"> </span>
<span class="p">{</span>
<span class="w">   </span><span class="k">public</span><span class="w"> </span><span class="n">DbSet</span><span class="o">&lt;</span><span class="n">Book</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Books</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">   </span><span class="k">protected</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">OnModelCreating</span><span class="p">(</span><span class="n">ModelBuilder</span><span class="w"> </span><span class="n">modelBuilder</span><span class="p">)</span><span class="w"> </span>
<span class="w">   </span><span class="p">{</span>
<span class="w">     </span><span class="n">modelBuilder</span><span class="p">.</span><span class="n">Entity</span><span class="o">&lt;</span><span class="n">Category</span><span class="o">&gt;</span><span class="p">().</span><span class="n">HasData</span><span class="p">(</span>
<span class="w">       </span><span class="k">new</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">Name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"Ezoterika"</span><span class="p">,</span><span class="w"> </span><span class="n">ParentCategoryId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">null</span><span class="p">,</span><span class="w"> </span><span class="n">Order</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"00"</span><span class="w"> </span><span class="p">},</span>
<span class="w">       </span><span class="k">new</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">Name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"Feng shui"</span><span class="p">,</span><span class="w"> </span><span class="n">ParentCategoryId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">Order</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"00.01"</span><span class="w"> </span><span class="p">},</span>
<span class="w">       </span><span class="k">new</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">Name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"Horoszkóp, asztrológia"</span><span class="p">,</span><span class="w"> </span><span class="n">ParentCategoryId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">Order</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"00.02"</span><span class="w"> </span><span class="p">},</span>
<span class="w">       </span><span class="k">new</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="n">Name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"Parapszichológia"</span><span class="p">,</span><span class="w"> </span><span class="n">ParentCategoryId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">Order</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"00.03"</span><span class="w"> </span><span class="p">},</span>
<span class="w">       </span><span class="k">new</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="n">Name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"Irodalom"</span><span class="p">,</span><span class="w"> </span><span class="n">ParentCategoryId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">null</span><span class="p">,</span><span class="w"> </span><span class="n">Order</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"01"</span><span class="w"> </span><span class="p">},</span>
<span class="w">       </span><span class="k">new</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="n">Name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"Életrajz"</span><span class="p">,</span><span class="w"> </span><span class="n">ParentCategoryId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="n">Order</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"01.01"</span><span class="w"> </span><span class="p">},</span>
<span class="w">       </span><span class="k">new</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="n">Name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"Dráma, színmű"</span><span class="p">,</span><span class="w"> </span><span class="n">ParentCategoryId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="n">Order</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"01.02"</span><span class="w"> </span><span class="p">},</span>
<span class="w">       </span><span class="k">new</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="n">Name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"Vers, eposz"</span><span class="p">,</span><span class="w"> </span><span class="n">ParentCategoryId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="n">Order</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"01.03"</span><span class="w"> </span><span class="p">},</span>
<span class="w">       </span><span class="k">new</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">9</span><span class="p">,</span><span class="w"> </span><span class="n">Name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"Tankönyvek"</span><span class="p">,</span><span class="w"> </span><span class="n">ParentCategoryId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">null</span><span class="p">,</span><span class="w"> </span><span class="n">Order</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"02"</span><span class="w"> </span><span class="p">},</span>
<span class="w">       </span><span class="k">new</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="n">Name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"Matematika"</span><span class="p">,</span><span class="w"> </span><span class="n">ParentCategoryId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">null</span><span class="p">,</span><span class="w"> </span><span class="n">Order</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"02.01"</span><span class="w"> </span><span class="p">},</span>
<span class="w">       </span><span class="k">new</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">11</span><span class="p">,</span><span class="w"> </span><span class="n">Name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"Kémia"</span><span class="p">,</span><span class="w"> </span><span class="n">ParentCategoryId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">null</span><span class="p">,</span><span class="w"> </span><span class="n">Order</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"02.02"</span><span class="w"> </span><span class="p">},</span>
<span class="w">       </span><span class="k">new</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span><span class="w"> </span><span class="n">Name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"Közgazdaságtudomány"</span><span class="p">,</span><span class="w"> </span><span class="n">ParentCategoryId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">null</span><span class="p">,</span><span class="w"> </span><span class="n">Order</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"02.03"</span><span class="w"> </span><span class="p">},</span>
<span class="w">       </span><span class="k">new</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">13</span><span class="p">,</span><span class="w"> </span><span class="n">Name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"Biológia"</span><span class="p">,</span><span class="w"> </span><span class="n">ParentCategoryId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">null</span><span class="p">,</span><span class="w"> </span><span class="n">Order</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"02.04"</span><span class="w"> </span><span class="p">},</span>
<span class="w">       </span><span class="k">new</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">14</span><span class="p">,</span><span class="w"> </span><span class="n">Name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"Regény"</span><span class="p">,</span><span class="w"> </span><span class="n">ParentCategoryId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">null</span><span class="p">,</span><span class="w"> </span><span class="n">Order</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"03"</span><span class="w"> </span><span class="p">},</span>
<span class="w">       </span><span class="k">new</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span><span class="w"> </span><span class="n">Name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"Családregény"</span><span class="p">,</span><span class="w"> </span><span class="n">ParentCategoryId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">14</span><span class="p">,</span><span class="w"> </span><span class="n">Order</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"03.01"</span><span class="w"> </span><span class="p">},</span>
<span class="w">       </span><span class="k">new</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">16</span><span class="p">,</span><span class="w"> </span><span class="n">Name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"Fantasy"</span><span class="p">,</span><span class="w"> </span><span class="n">ParentCategoryId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">14</span><span class="p">,</span><span class="w"> </span><span class="n">Order</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"03.02"</span><span class="w"> </span><span class="p">},</span>
<span class="w">       </span><span class="k">new</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">17</span><span class="p">,</span><span class="w"> </span><span class="n">Name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"Erotikus"</span><span class="p">,</span><span class="w"> </span><span class="n">ParentCategoryId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">14</span><span class="p">,</span><span class="w"> </span><span class="n">Order</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"03.03"</span><span class="w"> </span><span class="p">},</span>
<span class="w">       </span><span class="k">new</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">18</span><span class="p">,</span><span class="w"> </span><span class="n">Name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"Krimi"</span><span class="p">,</span><span class="w"> </span><span class="n">ParentCategoryId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">14</span><span class="p">,</span><span class="w"> </span><span class="n">Order</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"03.04"</span><span class="w"> </span><span class="p">},</span>
<span class="w">       </span><span class="k">new</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">19</span><span class="p">,</span><span class="w"> </span><span class="n">Name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"Sci - fi"</span><span class="p">,</span><span class="w"> </span><span class="n">ParentCategoryId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">14</span><span class="p">,</span><span class="w"> </span><span class="n">Order</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"03.05"</span><span class="w"> </span><span class="p">},</span>
<span class="w">       </span><span class="k">new</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="n">Name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"Thriller"</span><span class="p">,</span><span class="w"> </span><span class="n">ParentCategoryId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">14</span><span class="p">,</span><span class="w"> </span><span class="n">Order</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"03.06"</span><span class="w"> </span><span class="p">},</span>
<span class="w">       </span><span class="k">new</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">21</span><span class="p">,</span><span class="w"> </span><span class="n">Name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"Történelmi"</span><span class="p">,</span><span class="w"> </span><span class="n">ParentCategoryId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">14</span><span class="p">,</span><span class="w"> </span><span class="n">Order</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"03.07"</span><span class="w"> </span><span class="p">}</span>
<span class="w">     </span><span class="p">);</span>

<span class="w">     </span><span class="n">modelBuilder</span><span class="p">.</span><span class="n">Entity</span><span class="o">&lt;</span><span class="n">Book</span><span class="o">&gt;</span><span class="p">().</span><span class="n">HasData</span><span class="p">(</span>
<span class="w">       </span><span class="k">new</span><span class="w"> </span><span class="nf">Book</span><span class="p">()</span>
<span class="w">       </span><span class="p">{</span>
<span class="w">         </span><span class="n">Id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">         </span><span class="n">Title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"A személyes feng shui tanácsadó"</span><span class="p">,</span>
<span class="w">         </span><span class="n">Author</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"Lam Kam Chuen Mester"</span><span class="p">,</span>
<span class="w">         </span><span class="n">Subtitle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"Hogyan éljünk egészségesen és harmonikusan"</span><span class="p">,</span>
<span class="w">         </span><span class="n">PageNumber</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">168</span><span class="p">,</span>
<span class="w">         </span><span class="n">Price</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3200</span><span class="p">,</span>
<span class="w">         </span><span class="n">PublishYear</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2004</span><span class="p">,</span>
<span class="w">         </span><span class="n">ShortDescription</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"A Személyes feng shui tanácsadó elmagyarázza a feng shui alapelveit..."</span><span class="p">,</span>
<span class="w">       </span><span class="p">},</span>

<span class="w">       </span><span class="k">new</span><span class="w"> </span><span class="nf">Book</span><span class="p">()</span>
<span class="w">       </span><span class="p">{</span>
<span class="w">         </span><span class="n">Id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span>
<span class="w">         </span><span class="n">Title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"Az én feng shui-kertem"</span><span class="p">,</span>
<span class="w">         </span><span class="n">Author</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"Susanne Schumacher"</span><span class="p">,</span>
<span class="w">         </span><span class="n">Subtitle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"Ötletek kertekhez, teraszokhoz, erkélyekhez"</span><span class="p">,</span>
<span class="w">         </span><span class="n">PageNumber</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">128</span><span class="p">,</span>
<span class="w">         </span><span class="n">Price</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4900</span><span class="p">,</span>
<span class="w">         </span><span class="n">PublishYear</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2008</span><span class="p">,</span>
<span class="w">         </span><span class="n">ShortDescription</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"Képzelje azt, hogy kertje egy ruhadarab...."</span><span class="p">,</span>
<span class="w">       </span><span class="p">},</span>

<span class="w">       </span><span class="k">new</span><span class="w"> </span><span class="nf">Book</span><span class="p">()</span>
<span class="w">       </span><span class="p">{</span>
<span class="w">         </span><span class="n">Id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span>
<span class="w">         </span><span class="n">Title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"Feng Shui"</span><span class="p">,</span>
<span class="w">         </span><span class="n">Author</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"Ernest J. Eitel"</span><span class="p">,</span>
<span class="w">         </span><span class="n">Subtitle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"A természet és az egyensúly kínai tudományával kapcsolatos alapvető tudnivalók"</span><span class="p">,</span>
<span class="w">         </span><span class="n">PageNumber</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">80</span><span class="p">,</span>
<span class="w">         </span><span class="n">Price</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">699</span><span class="p">,</span>
<span class="w">         </span><span class="n">PublishYear</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2012</span><span class="p">,</span>
<span class="w">         </span><span class="n">ShortDescription</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"Az ember, az ember által létrehozott környezet..."</span><span class="p">,</span>
<span class="w">       </span><span class="p">}</span>
<span class="w">     </span><span class="p">);</span>
<span class="w">   </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</li>
<li>
<p>Most, hogy elkészültünk az ősadatokkal, újabb migrációt kell készítenünk, ami az adatok betöltéséért lesz felelős. Szintén a <code>Package Manager Console</code>-ban adjuk ki a <code>Add-Migration</code> parancsot, ügyelve arra, hogy a <code>Bookshop.Dal</code> projekt legyen kiválasztva:</p>
<div class="highlight"><pre><span></span><code><span class="nb">Add-Migration</span> <span class="n">InitialSeed</span>
</code></pre></div>
<details class="success">
<summary>Ha mindent jól csináltunk így fog kinézni a migrációnk.</summary>
<figure>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="images/initial-seed.png" data-desc-position="bottom"><img alt="Initial seed" src="images/initial-seed.png"></a></p>
<figcaption>
<p>Migrációs fájl az ősadat feltöltéshez.</p>
</figcaption>
</figure>
</details>
</li>
<li>
<p>Futtassuk is le a migrációt</p>
<div class="highlight"><pre><span></span><code><span class="nb">Update-Database</span>
</code></pre></div>
<details class="success" open="open">
<summary>Ősadatok bekerültek az</summary>
<figure>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="images/initial-data-in-db.png" data-desc-position="bottom"><img alt="Initial data in DB" src="images/initial-data-in-db.png"></a></p>
<figcaption>
<p>Az adatok bekerültek az adatbázisba is.</p>
</figcaption>
</figure>
</details>
</li>
<li>
<p>Figyeljük meg, hogy bár a <code>Book.cs</code>-ben nem vettük fel <code>CategoryId</code> tulajdonságot, mégis az adatbázisba létrejött egy ilyen oszlop. Ez azért van, mert a <code>Category.cs</code>-ben felvettünk egy navigációs tulajdonságot a <code>Books</code> listát, ami egy egy-többes kapcsolat a kategória és a könyv között így az EF automatikusan létrehozza az adatbázisban a szükséges mezőt.</p>
<details class="warning" open="open">
<summary>CategoryId az adatbázisban???</summary>
<figure>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="images/db-categoryId.png" data-desc-position="bottom"><img alt="DB categoryId" src="images/db-categoryId.png"></a></p>
<figcaption>
<p>Adatbázisban ott van a CategoryId a Book táblában</p>
</figcaption>
</figure>
</details>
</li>
<li>
<p>Azért, hogy az EF modellben is látható legyen ez a kapcsolat érdemes a modellt kibővíteni ezzel a tulajdonsággal és a navigációt tulajdonságot a másik irányba is felvenni. Mivel most nem szeretnénk mindenhol kitölteni ezt az értéket ezért nullable-nek vesszük fel.</p>
<div class="highlight"><span class="filename">Book.cs</span><pre><span></span><code><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Book</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">Id</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">Title</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">null</span><span class="o">!</span><span class="p">;</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">Author</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">null</span><span class="o">!</span><span class="p">;</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">string?</span><span class="w"> </span><span class="n">Subtitle</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">string?</span><span class="w"> </span><span class="n">ShortDescription</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">decimal</span><span class="w"> </span><span class="n">Price</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">decimal?</span><span class="w"> </span><span class="n">DiscountedPrice</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">PublishYear</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">PageNumber</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="hll"><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">int?</span><span class="w"> </span><span class="n">CategoryId</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</span><span class="hll"><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">Category</span><span class="o">?</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</span><span class="p">}</span>
</code></pre></div>
</li>
<li>
<p>Illetve a DbDiagram-ot is érdemes beállítani ezt a kapcsolatot. A tulajdonság már ott lesz, hiszen a modellbe bekerült. Általánosságban elmondható, hogy a navigációs tulajdonságoknál érdemes mind a két irányt felvenni.</p>
<details class="success" open="open">
<summary>CategoryId felvéve az adat modell diagramra</summary>
<figure>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="images/diagram-categoryId.png" data-desc-position="bottom"><img alt="diagram-categoryId" src="images/diagram-categoryId.png"></a></p>
<figcaption>
<p>CategoryId felvétele az adatmodell diagramra.</p>
</figcaption>
</figure>
</details>
</li>
</ol>
<h3 id="dto-k-keszitese">DTO-k készítése<a class="headerlink" href="#dto-k-keszitese" title="Permanent link">¶</a></h3>
<ol>
<li>
<p>Az adatbázis entitások már megvannak, viszont nem szeretnénk, hogy a kliens oldalra, vagy a webes felületre entitások jussanak el, ezért a Transfer projektben hozzuk létre azokat a DTO osztályokat, amit majd a Webes projekt / kliens használni fog. A DTO-k elnevezésénél nem érdemes a DTO postfixet használni. Használjuk helyette inkább az alábbi konvenciót:</p>
<ul>
<li>Header: Csak alap adatokat tartalmaz, nem hivatkozik más DTO-ra</li>
<li>Data: A fontosabb adatokat tartalmazza, hivatkozhat más DTO-ra is.</li>
<li>Details: Minden vagy a szerkesztéshez szükséges adatokat tartalmazza.</li>
</ul>
</li>
<li>
<p>Hozzunk létre egy <code>BookData.cs</code> osztályt az alábbi tartalommal.</p>
<div class="highlight"><span class="filename">BookData.cs</span><pre><span></span><code><span class="k">namespace</span><span class="w"> </span><span class="nn">BookShop.Transfer</span><span class="p">;</span>

<span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">BookData</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">Id</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">Title</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">null</span><span class="o">!</span><span class="p">;</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">Author</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">null</span><span class="o">!</span><span class="p">;</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">string?</span><span class="w"> </span><span class="n">Subtitle</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">string?</span><span class="w"> </span><span class="n">ShortDescription</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">decimal</span><span class="w"> </span><span class="n">Price</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">decimal?</span><span class="w"> </span><span class="n">DiscountPrice</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">PublishYear</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">PageNumber</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">int?</span><span class="w"> </span><span class="n">CategoryId</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</li>
<li>
<p>Hozzuk létre hasonlóan a <code>CategoryHeader</code> osztályt is.</p>
<div class="highlight"><span class="filename">CategoryHeader.cs</span><pre><span></span><code><span class="k">namespace</span><span class="w"> </span><span class="nn">BookShop.Transfer</span><span class="p">;</span>

<span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">CategoryHeader</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">Id</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">Name</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">null</span><span class="o">!</span><span class="p">;</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">Level</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</li>
<li>
<p>Ez után már csak annyi feladatunk van, hogy a BLL-ben elkészítjük az adatbázis lekérdezéseket, amik DTO-kat adnak vissza.</p>
</li>
</ol>
<h3 id="bll-service-ek-megvalositasa">BLL service-ek megvalósítása<a class="headerlink" href="#bll-service-ek-megvalositasa" title="Permanent link">¶</a></h3>
<p>A BLL-ben valósítjuk meg azokat a szolgáltatásokat és hozzá tartozó interfészeket, amivel adatokat tudunk lekérdezni az adatbázisból, illetve itt valósítjuk meg az entitás → DTO mappinget is.</p>
<ol>
<li>Hozzunk létre a <code>BookShop.Bll</code> projektben egy <code>ServicesInterfaces</code> és egy <code>Services</code> mappát.</li>
<li>
<p>Vegyük fel az <code>ServicesInterfaces</code> mappában az <code>IBookService.cs</code> fájlt, amiben definiálunk egy <code>GetBooksAsny()</code> metódust, ami majd visszaadja az összes könyvet egy listában.</p>
<div class="highlight"><span class="filename">IBookService.cs</span><pre><span></span><code><span class="k">using</span><span class="w"> </span><span class="nn">BookShop.Transfer</span><span class="p">;</span>

<span class="k">namespace</span><span class="w"> </span><span class="nn">BookShop.Bll.ServicesInterfaces</span><span class="p">;</span>

<span class="k">public</span><span class="w"> </span><span class="k">interface</span><span class="w"> </span><span class="n">IBookService</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Task</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">BookData</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">GetBooksAsync</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>
</li>
<li>
<p>Vegyük fel az <code>ServicesInterfaces</code> mappában az <code>ICatalogService.cs</code> fájlt, amiben definiálunk egy <code>GetCategoryTreeAsync()</code> metódust, ami majd visszaadja az összes kategóriát egy listában.</p>
<div class="highlight"><span class="filename">ICategoryService.cs</span><pre><span></span><code><span class="k">using</span><span class="w"> </span><span class="nn">BookShop.Transfer</span><span class="p">;</span>

<span class="k">namespace</span><span class="w"> </span><span class="nn">BookShop.Bll.ServicesInterfaces</span><span class="p">;</span>

<span class="k">public</span><span class="w"> </span><span class="k">interface</span><span class="w"> </span><span class="n">ICategoryService</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Task</span><span class="o">&lt;</span><span class="n">IEnumerable</span><span class="o">&lt;</span><span class="n">CategoryHeader</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">GetCategoryTreeAsync</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>
</li>
<li>
<p>Készítsük is el az <code>IBookService</code> interfész implementációját is, amit a <code>Services</code> mappában tegyünk <code>BookService</code> névvel. A metódus cím szerint sorbarendezbe kell, hogy visszaadjon a <code>BookData</code> listát. Az alábbiakban látható hozzá az implementáció.</p>
<div class="highlight"><span class="filename">BookService.cs</span><pre><span></span><code><span class="k">using</span><span class="w"> </span><span class="nn">BookShop.Bll.ServicesInterfaces</span><span class="p">;</span>
<span class="k">using</span><span class="w"> </span><span class="nn">BookShop.Dal</span><span class="p">;</span>
<span class="k">using</span><span class="w"> </span><span class="nn">BookShop.Transfer</span><span class="p">;</span>
<span class="k">using</span><span class="w"> </span><span class="nn">Microsoft.EntityFrameworkCore</span><span class="p">;</span>

<span class="k">namespace</span><span class="w"> </span><span class="nn">BookShop.Bll.Services</span><span class="p">;</span>

<span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nf">BookService</span><span class="p">(</span><span class="n">BookShopDbContext</span><span class="w"> </span><span class="n">dbContext</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">IBookService</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="n">BookShopDbContext</span><span class="w"> </span><span class="n">dbContext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dbContext</span><span class="p">;</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="n">Task</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">BookData</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">GetBooksAsync</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">books</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="n">dbContext</span><span class="p">.</span><span class="n">Books</span>
<span class="w">            </span><span class="p">.</span><span class="n">OrderBy</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">Title</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="n">Select</span><span class="p">(</span><span class="n">b</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">BookData</span><span class="p">()</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="n">Id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">Id</span><span class="p">,</span>
<span class="w">                </span><span class="n">Title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">Title</span><span class="p">,</span>
<span class="w">                </span><span class="n">Subtitle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">Subtitle</span><span class="p">,</span>
<span class="w">                </span><span class="n">ShortDescription</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">ShortDescription</span><span class="p">,</span>
<span class="w">                </span><span class="n">Price</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">Price</span><span class="p">,</span>
<span class="w">                </span><span class="n">DiscountPrice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">DiscountedPrice</span><span class="p">,</span>
<span class="w">                </span><span class="n">PublishYear</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">PublishYear</span><span class="p">,</span>
<span class="w">                </span><span class="n">PageNumber</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">PageNumber</span><span class="p">,</span>
<span class="w">                </span><span class="n">Author</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">Author</span><span class="p">,</span>
<span class="w">                </span><span class="n">CategoryId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">CategoryId</span><span class="p">,</span>
<span class="w">            </span><span class="p">})</span>
<span class="w">            </span><span class="p">.</span><span class="n">ToListAsync</span><span class="p">();</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">books</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</li>
<li>
<p>Készítsük is el az <code>ICategoryService</code> interfész implementációját is <code>CategoryService</code> névvel. Az összes kategóriát vissza kell adni <code>Order</code> szerint rendezve. A <code>Level</code>-t úgy tudjuk meghatározni, hogy az <code>Order</code>-ben hány darab pont szerepel. Az alábbiakban látható hozzá az implementáció.</p>
<div class="highlight"><span class="filename">CategoryService.cs</span><pre><span></span><code><span class="k">using</span><span class="w"> </span><span class="nn">BookShop.Bll.ServicesInterfaces</span><span class="p">;</span>
<span class="k">using</span><span class="w"> </span><span class="nn">BookShop.Dal</span><span class="p">;</span>
<span class="k">using</span><span class="w"> </span><span class="nn">BookShop.Transfer</span><span class="p">;</span>
<span class="k">using</span><span class="w"> </span><span class="nn">Microsoft.EntityFrameworkCore</span><span class="p">;</span>

<span class="k">namespace</span><span class="w"> </span><span class="nn">BookShop.Bll.Services</span><span class="p">;</span>

<span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nf">CategoryService</span><span class="p">(</span><span class="n">BookShopDbContext</span><span class="w"> </span><span class="n">dbContext</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">ICategoryService</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="n">BookShopDbContext</span><span class="w"> </span><span class="n">_dbContext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dbContext</span><span class="p">;</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="n">Task</span><span class="o">&lt;</span><span class="n">IEnumerable</span><span class="o">&lt;</span><span class="n">CategoryHeader</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">GetCategoryTreeAsync</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">allCategories</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="n">_dbContext</span><span class="p">.</span><span class="n">Categories</span>
<span class="w">            </span><span class="p">.</span><span class="n">OrderBy</span><span class="p">(</span><span class="n">c</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">Order</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="n">Select</span><span class="p">(</span><span class="n">c</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">CategoryHeader</span><span class="p">()</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="n">Id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">Id</span><span class="p">,</span>
<span class="w">                </span><span class="n">Name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">Name</span><span class="p">,</span>
<span class="w">                </span><span class="n">Level</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">Order</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">null</span>
<span class="w">                    </span><span class="o">?</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">Order</span><span class="p">.</span><span class="n">Split</span><span class="p">(</span><span class="s">"."</span><span class="p">,</span><span class="w"> </span><span class="n">StringSplitOptions</span><span class="p">.</span><span class="n">None</span><span class="p">).</span><span class="n">Length</span>
<span class="w">                    </span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">            </span><span class="p">})</span>
<span class="w">            </span><span class="p">.</span><span class="n">ToListAsync</span><span class="p">();</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">allCategories</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</li>
</ol>
<h4 id="automapper">AutoMapper<a class="headerlink" href="#automapper" title="Permanent link">¶</a></h4>
<p>Ahogy a fenti kódban látható most egy egyes Service-ekben található az entitás -&gt; DTO mappelés, ami működő megoldás, viszont nem lehet újrahasznosítani a mappeléseket.
A gyakorlatban az <a href="https://automapper.io/">AutoMapper</a> csomag segítségével lehet ezeket a mappeléseket kiszervezni egy közös részbe. Regisztráció után lehet ingyenes licensz kulcsot igényelni, ami 1 évig érvényes. Lejárat után ingyenesen meghosszabbítható. Csak nagyvállalatoknak kell fizetni érte részeletek az <a href="https://automapper.io/#pricing">árazás</a> oldalon. A licensz kulcs a <a href="https://luckypennysoftware.com/account">Profil</a> oldalról tölthető le.</p>
<ol>
<li>A <code>BookShop.Bll</code> projekthez vegyük fel az <code>AutoMapper</code> NuGet package-et.</li>
<li>Vegyünk fel egy <code>Mappings</code> könyvtárat, ahova az AutoMapper profile-ok kerülnek majd.</li>
<li>
<p>Készítsük el a <code>CategoryProfile</code> osztályt, ami a <code>AutoMapper.Profile</code> osztályból származik és a konstruktorában hozzunk létre egy mappinget. A mappinget az alábbi két módon hozhatjuk létre:</p>
<ul>
<li><strong><code>CreateMap&lt;Entity, Dto&gt;</code></strong>: Használható  <code>ProjectTo</code> metódussal és, a <code>Map</code>-pal is. A <code>Map</code> olyan mappelést tesz lehetővé, ahol a kód nem fordul SQL-re, tehát egy tetszőleges listát is át tudunk a memóriában mappelni. Csak akkor érdemes a <code>CreateMap&lt;Entity, Dto&gt;</code> használata, ha memóriában is szeretnénk mappelni.</li>
<li><strong><code>CreateProjecton&lt;Entity, Dto&gt;</code></strong>: Csak a <code>ProjectTo</code> metódussal használható, a <code>Map</code>-pel nem, cserébe gyorsabb. Általában ezt szoktuk használni, hiszen a <code>ProjectTo</code> teszi lehetővé, hogy az adatbázisból csak azt kérdezzük le, amire szükségünk van. Ha komplex mappelést készítünk, például az őszosztály mappelését szeretnénk belevennie a leszármazott osztály mappelésébe, akkor kénytelenek vagyunk a <code>CreateMap</code>-et használni.</li>
</ul>
<div class="highlight"><span class="filename">CategoryProfile.cs</span><pre><span></span><code><span class="k">using</span><span class="w"> </span><span class="nn">AutoMapper</span><span class="p">;</span>
<span class="k">using</span><span class="w"> </span><span class="nn">BookShop.Dal.Entities</span><span class="p">;</span>
<span class="k">using</span><span class="w"> </span><span class="nn">BookShop.Transfer</span><span class="p">;</span>

<span class="k">namespace</span><span class="w"> </span><span class="nn">BookShop.Bll.Mappings</span><span class="p">;</span>

<span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">CategoryProfile</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Profile</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="nf">CategoryProfile</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">CreateProjection</span><span class="o">&lt;</span><span class="n">Category</span><span class="p">,</span><span class="w"> </span><span class="n">CategoryHeader</span><span class="o">&gt;</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="n">ForMember</span><span class="p">(</span><span class="n">dest</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">dest</span><span class="p">.</span><span class="n">Id</span><span class="p">,</span><span class="w"> </span><span class="n">opt</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">opt</span><span class="p">.</span><span class="n">MapFrom</span><span class="p">(</span><span class="n">src</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">src</span><span class="p">.</span><span class="n">Id</span><span class="p">))</span>
<span class="w">            </span><span class="p">.</span><span class="n">ForMember</span><span class="p">(</span><span class="n">dest</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">dest</span><span class="p">.</span><span class="n">Name</span><span class="p">,</span><span class="w"> </span><span class="n">opt</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">opt</span><span class="p">.</span><span class="n">MapFrom</span><span class="p">(</span><span class="n">src</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">src</span><span class="p">.</span><span class="n">Name</span><span class="p">))</span>
<span class="w">            </span><span class="p">.</span><span class="n">ForMember</span><span class="p">(</span><span class="n">dest</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">dest</span><span class="p">.</span><span class="n">Level</span><span class="p">,</span><span class="w"> </span><span class="n">opt</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">opt</span><span class="p">.</span><span class="n">MapFrom</span><span class="p">(</span><span class="n">src</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">src</span><span class="p">.</span><span class="n">Order</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">null</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">src</span><span class="p">.</span><span class="n">Order</span><span class="p">.</span><span class="n">Split</span><span class="w">   </span><span class="p">(</span><span class="s">"."</span><span class="p">,</span><span class="w"> </span><span class="n">StringSplitOptions</span><span class="p">.</span><span class="n">None</span><span class="p">).</span><span class="n">Length</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span><span class="w">   </span>
</code></pre></div>
</li>
<li>
<p>Ahogy a fenti kódban is látszódik minden tulajdonságot mappelünk. Ezt nem kötelező, mert az AutoMapper az azonos nevű tulajdonságokat automatikusan mappeli.
Azonban ha a kódot refaktoráljuk, akkor a mappelés eltörhet. Gondoljuk végig, hogy a DTO-ban átnevezünk egy tulajdonságot és mindenhol ahol előfordul ott is átnevezésre kerül automatikusan. Viszont mivel a mappingben nem szerepel az adott tulajdonság, mert konvenció alapján mappeli az AutoMapper és az átnevezés után már nem is egyezik meg a DTO-ban és az entitáson a tulajdonság el fog törni a kód.</p>
</li>
<li>
<p>A fentihez hasonló módon készítsük el a <code>BookProfile</code> osztályt is.</p>
<div class="highlight"><span class="filename">BookProfile.cs</span><pre><span></span><code><span class="k">using</span><span class="w"> </span><span class="nn">AutoMapper</span><span class="p">;</span>
<span class="k">using</span><span class="w"> </span><span class="nn">BookShop.Dal.Entities</span><span class="p">;</span>
<span class="k">using</span><span class="w"> </span><span class="nn">BookShop.Transfer</span><span class="p">;</span>

<span class="k">namespace</span><span class="w"> </span><span class="nn">BookShop.Bll.Mappings</span><span class="p">;</span>

<span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">BookProfile</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Profile</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="nf">BookProfile</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">CreateProjection</span><span class="o">&lt;</span><span class="n">Book</span><span class="p">,</span><span class="w"> </span><span class="n">BookData</span><span class="o">&gt;</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="n">ForMember</span><span class="p">(</span><span class="n">dest</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">dest</span><span class="p">.</span><span class="n">Id</span><span class="p">,</span><span class="w"> </span><span class="n">opt</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">opt</span><span class="p">.</span><span class="n">MapFrom</span><span class="p">(</span><span class="n">src</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">src</span><span class="p">.</span><span class="n">Id</span><span class="p">))</span>
<span class="w">            </span><span class="p">.</span><span class="n">ForMember</span><span class="p">(</span><span class="n">dest</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">dest</span><span class="p">.</span><span class="n">Title</span><span class="p">,</span><span class="w"> </span><span class="n">opt</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">opt</span><span class="p">.</span><span class="n">MapFrom</span><span class="p">(</span><span class="n">src</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">src</span><span class="p">.</span><span class="n">Title</span><span class="p">))</span>
<span class="w">            </span><span class="p">.</span><span class="n">ForMember</span><span class="p">(</span><span class="n">dest</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">dest</span><span class="p">.</span><span class="n">Subtitle</span><span class="p">,</span><span class="w"> </span><span class="n">opt</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">opt</span><span class="p">.</span><span class="n">MapFrom</span><span class="p">(</span><span class="n">src</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">src</span><span class="p">.</span><span class="n">Subtitle</span><span class="p">))</span>
<span class="w">            </span><span class="p">.</span><span class="n">ForMember</span><span class="p">(</span><span class="n">dest</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">dest</span><span class="p">.</span><span class="n">ShortDescription</span><span class="p">,</span><span class="w"> </span><span class="n">opt</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">opt</span><span class="p">.</span><span class="n">MapFrom</span><span class="p">(</span><span class="n">src</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">src</span><span class="p">.</span><span class="n">ShortDescription</span><span class="p">))</span>
<span class="w">            </span><span class="p">.</span><span class="n">ForMember</span><span class="p">(</span><span class="n">dest</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">dest</span><span class="p">.</span><span class="n">Price</span><span class="p">,</span><span class="w"> </span><span class="n">opt</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">opt</span><span class="p">.</span><span class="n">MapFrom</span><span class="p">(</span><span class="n">src</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">src</span><span class="p">.</span><span class="n">Price</span><span class="p">))</span>
<span class="w">            </span><span class="p">.</span><span class="n">ForMember</span><span class="p">(</span><span class="n">dest</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">dest</span><span class="p">.</span><span class="n">DiscountPrice</span><span class="p">,</span><span class="w"> </span><span class="n">opt</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">opt</span><span class="p">.</span><span class="n">MapFrom</span><span class="p">(</span><span class="n">src</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">src</span><span class="p">.</span><span class="n">DiscountedPrice</span><span class="p">))</span>
<span class="w">            </span><span class="p">.</span><span class="n">ForMember</span><span class="p">(</span><span class="n">dest</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">dest</span><span class="p">.</span><span class="n">PublishYear</span><span class="p">,</span><span class="w"> </span><span class="n">opt</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">opt</span><span class="p">.</span><span class="n">MapFrom</span><span class="p">(</span><span class="n">src</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">src</span><span class="p">.</span><span class="n">PublishYear</span><span class="p">))</span>
<span class="w">            </span><span class="p">.</span><span class="n">ForMember</span><span class="p">(</span><span class="n">dest</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">dest</span><span class="p">.</span><span class="n">PageNumber</span><span class="p">,</span><span class="w"> </span><span class="n">opt</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">opt</span><span class="p">.</span><span class="n">MapFrom</span><span class="p">(</span><span class="n">src</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">src</span><span class="p">.</span><span class="n">PageNumber</span><span class="p">))</span>
<span class="w">            </span><span class="p">.</span><span class="n">ForMember</span><span class="p">(</span><span class="n">dest</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">dest</span><span class="p">.</span><span class="n">Author</span><span class="p">,</span><span class="w"> </span><span class="n">opt</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">opt</span><span class="p">.</span><span class="n">MapFrom</span><span class="p">(</span><span class="n">src</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">src</span><span class="p">.</span><span class="n">Author</span><span class="p">))</span>
<span class="w">            </span><span class="p">.</span><span class="n">ForMember</span><span class="p">(</span><span class="n">dest</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">dest</span><span class="p">.</span><span class="n">CategoryId</span><span class="p">,</span><span class="w"> </span><span class="n">opt</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">opt</span><span class="p">.</span><span class="n">MapFrom</span><span class="p">(</span><span class="n">src</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">src</span><span class="p">.</span><span class="n">CategoryId</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</li>
<li>
<p>A fenti kód elkészítésében a <strong>Code Completions</strong> a Visual Studio-ban sokat tud segíteni, akár a teljes kódot helyesen fel tudja ajánlani. Ez az opció akkor érhető el ha van GitHub Copilot előfizetés.</p>
<details class="tip" open="open">
<summary>AI kód kiegészítés</summary>
<figure>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="images/code-completions-AI.png" data-desc-position="bottom"><img alt="Code Completions AI" src="images/code-completions-AI.png"></a></p>
<figcaption>
<p>AI kód kiegészítés beállítása</p>
</figcaption>
</figure>
</details>
</li>
<li>
<p>Ha megvannak a mapper profilok, akkor már csak annyi dolgunk van, hogy a service-ekben lecseréljük a <code>Select</code>-et egy <code>ProjectTo</code>-ra. Mivel a <code>ProjectTo&lt;DTO&gt;()</code> vár egy <code>IConfigurationProvider</code> paramétert is, a szolgáltatás konstruktorának át kell adni egy <code>IMapper</code>-t, amit majd a DI konténerbe be kell regisztrálni. Ez a regisztrációt majd a Console Application-ben fogjuk megtenni.</p>
</li>
<li>
<p>Módosítjuk a <code>CategoryService</code>-t, hogy a <code>ProjectTo</code>-t használja.</p>
<div class="highlight"><span class="filename">CategoryService.cs</span><pre><span></span><code><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nf">CategoryService</span><span class="p">(</span><span class="n">BookShopDbContext</span><span class="w"> </span><span class="n">dbContext</span><span class="p">,</span><span class="w"> </span><span class="n">IMapper</span><span class="w"> </span><span class="n">mapper</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">ICategoryService</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="n">BookShopDbContext</span><span class="w"> </span><span class="n">_dbContext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dbContext</span><span class="p">;</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="n">Task</span><span class="o">&lt;</span><span class="n">IEnumerable</span><span class="o">&lt;</span><span class="n">CategoryHeader</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">GetCategoryTreeAsync</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">allCategories</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="n">_dbContext</span><span class="p">.</span><span class="n">Categories</span>
<span class="w">            </span><span class="p">.</span><span class="n">OrderBy</span><span class="p">(</span><span class="n">c</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">Order</span><span class="p">)</span>
<span class="hll"><span class="w">            </span><span class="p">.</span><span class="n">ProjectTo</span><span class="o">&lt;</span><span class="n">CategoryHeader</span><span class="o">&gt;</span><span class="p">(</span><span class="n">mapper</span><span class="p">.</span><span class="n">ConfigurationProvider</span><span class="p">)</span>
</span><span class="w">            </span><span class="p">.</span><span class="n">ToListAsync</span><span class="p">();</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">allCategories</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</li>
<li>
<p>Módosítjuk a <code>BookService</code>-t is, hogy a <code>ProjectTo</code>-t használja.</p>
<div class="highlight"><span class="filename">BookService.cs</span><pre><span></span><code><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nf">BookService</span><span class="p">(</span><span class="n">BookShopDbContext</span><span class="w"> </span><span class="n">dbContext</span><span class="p">,</span><span class="w"> </span><span class="n">IMapper</span><span class="w"> </span><span class="n">mapper</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">IBookService</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="n">BookShopDbContext</span><span class="w"> </span><span class="n">dbContext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dbContext</span><span class="p">;</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="n">Task</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">BookData</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">GetBooksAsync</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">books</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="n">dbContext</span><span class="p">.</span><span class="n">Books</span>
<span class="w">            </span><span class="p">.</span><span class="n">OrderBy</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">Title</span><span class="p">)</span>
<span class="hll"><span class="w">            </span><span class="p">.</span><span class="n">ProjectTo</span><span class="o">&lt;</span><span class="n">BookData</span><span class="o">&gt;</span><span class="p">(</span><span class="n">mapper</span><span class="p">.</span><span class="n">ConfigurationProvider</span><span class="p">)</span>
</span><span class="w">            </span><span class="p">.</span><span class="n">ToListAsync</span><span class="p">();</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">books</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</li>
<li>
<p>Ezt most nem tudjuk még kipróbálni, mert nincs futtatható projektünk. Ezért a következő lépésben egy egyszerű Console App-ot adunk a solution-höz, hogy el is tudjuk indítani az alkalmazást.</p>
</li>
</ol>
<h3 id="wireupcs">Wireup.cs<a class="headerlink" href="#wireupcs" title="Permanent link">¶</a></h3>
<ol>
<li>Adjuk a <code>BookShop.Bll</code> projekthez a <code>Microsoft.Extensions.Configuration.Binder</code> nuGet package-et.</li>
<li>
<p>Készítsünk egy <code>Wireup.cs</code>-t a <code>BookShop.Bll</code> projekt gyökerébe is. Itt az AutoMapper-t és a BLL szolgáltatásokat kell regisztrálni és a DAL-ban létrehozott <code>AddBookShopDbContext</code>-t meghívni.</p>
<div class="highlight"><span class="filename">Wireup.cs</span><pre><span></span><code><span class="k">using</span><span class="w"> </span><span class="nn">BookShop.Bll.Mappings</span><span class="p">;</span>
<span class="k">using</span><span class="w"> </span><span class="nn">BookShop.Bll.Services</span><span class="p">;</span>
<span class="k">using</span><span class="w"> </span><span class="nn">BookShop.Bll.ServicesInterfaces</span><span class="p">;</span>
<span class="k">using</span><span class="w"> </span><span class="nn">BookShop.Dal</span><span class="p">;</span>
<span class="k">using</span><span class="w"> </span><span class="nn">Microsoft.Extensions.Configuration</span><span class="p">;</span>
<span class="k">using</span><span class="w"> </span><span class="nn">Microsoft.Extensions.DependencyInjection</span><span class="p">;</span>

<span class="k">namespace</span><span class="w"> </span><span class="nn">BookShop.Bll</span><span class="p">;</span>

<span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Wireup</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">IServiceCollection</span><span class="w"> </span><span class="nf">AddBllServices</span><span class="p">(</span><span class="k">this</span><span class="w"> </span><span class="n">IServiceCollection</span><span class="w"> </span><span class="n">services</span><span class="p">,</span><span class="w"> </span><span class="n">IConfiguration</span><span class="w"> </span><span class="n">configuration</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// DB Context regisztrálása a DI containerbe.</span>
<span class="w">        </span><span class="n">services</span><span class="p">.</span><span class="n">AddBookShopDbContext</span><span class="p">(</span><span class="n">configuration</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// AutoMapper regisztrálása a DI containerbe.</span>
<span class="w">        </span><span class="n">services</span><span class="p">.</span><span class="n">AddAutoMapper</span><span class="p">(</span>
<span class="w">                </span><span class="n">cfg</span><span class="w"> </span><span class="o">=&gt;</span>
<span class="w">                </span><span class="p">{</span>
<span class="w">                    </span><span class="n">cfg</span><span class="p">.</span><span class="n">LicenseKey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">configuration</span><span class="p">.</span><span class="n">GetRequiredSection</span><span class="p">(</span><span class="s">"AutoMapper"</span><span class="p">).</span><span class="n">GetValue</span><span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;</span><span class="p">(</span><span class="s">"LicenseKey"</span><span class="p">);</span>
<span class="w">                </span><span class="p">},</span><span class="w"> </span><span class="k">typeof</span><span class="p">(</span><span class="n">BookProfile</span><span class="p">));</span>

<span class="w">        </span><span class="c1">// Register Bll Servies</span>
<span class="w">        </span><span class="n">services</span><span class="p">.</span><span class="n">AddScoped</span><span class="o">&lt;</span><span class="n">IBookService</span><span class="p">,</span><span class="w"> </span><span class="n">BookService</span><span class="o">&gt;</span><span class="p">();</span>
<span class="w">        </span><span class="n">services</span><span class="p">.</span><span class="n">AddScoped</span><span class="o">&lt;</span><span class="n">ICategoryService</span><span class="p">,</span><span class="w"> </span><span class="n">CategoryService</span><span class="o">&gt;</span><span class="p">();</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">services</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</li>
</ol>
<h2 id="console-app-letrehozasa">Console App létrehozása<a class="headerlink" href="#console-app-letrehozasa" title="Permanent link">¶</a></h2>
<ol>
<li>Adjunk a solution-hoz egy Console App-ot <code>BookShop.ConsoleApp</code> névvel.</li>
<li>Adjunk referenciát a <code>BookShop.Bll</code> projektre.</li>
<li>Ahhoz, hogy be tudjuk regisztrálni az AutoMappert és az adatbázis contextust a <code>Program.cs</code> fájlt ki kell egészíteni, mert alapértelmezés szerint nincs benne olyan kódrészlet ami appsettings.json-t fel tudná olvasni, illetve DI konténere sincs.</li>
<li>Adjuk hozzá a <code>BookShop.ConsoleApp</code> projekthez a <code>Microsoft.Extensions.Hosting</code> NuGet package-et. Ezzel tudunk majd létrehozni egy <code>HostApplicationBuilder</code>-t, amibe be tudjuk regisztrálni a szolgáltatásainkat és kezelni tudja az <code>appsetting.json</code> fájlt.</li>
<li>
<p>Adjunk a projekthez egy új JSON típusú fájlt <code>appsettings.json</code> névvel, majd állítsuk be a fájl tulajdonságai között (appsettings.json jobb klikk → Properties), hogy ha módosul másolja át az output könyvtárba</p>
<ul>
<li><strong>Copy To Output Directory</strong>: Copy if newer.</li>
</ul>
<details class="info">
<summary>Segítség - appsettings.json hozzáadása</summary>
<figure>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="images/add-appsettings-json.png" data-desc-position="bottom"><img alt="Add appsettings.json file" src="images/add-appsettings-json.png"></a></p>
<figcaption>
<p>appsettings.json fájl hozzáadása</p>
</figcaption>
</figure>
<figure>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="images/copy-appsettings.png" data-desc-position="bottom"><img alt="Copy appsettings" src="images/copy-appsettings.png"></a></p>
<figcaption>
<p>appsettings.json kerüljön be az outputba.</p>
</figcaption>
</figure>
</details>
</li>
<li>
<p>Adjuk hozzá az alábbi tartalmat az <code>appsettings.json</code> fájlhoz. A LicenseKey-hez azt az AutoMapper-től kapott licensz kulcsot kell bemásolni.</p>
<div class="highlight"><span class="filename">appsettings.json</span><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">"ConnectionStrings"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">"DefaultConnection"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Data Source=.;Initial Catalog=BookShopDb;Integrated Security=True;TrustServerCertificate=True"</span>
<span class="w">    </span><span class="p">},</span>

<span class="w">    </span><span class="nt">"AutoMapper"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="hll"><span class="w">    </span><span class="nt">"LicenseKey"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Nem tesszük ide a licensz kulcsot, mert az titok"</span>
</span><span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</li>
<li>
<p>A licensz kulcs egy védendő titok, így azt nem szerencsés beletenni az appsettings.json fájlba, mert akkor felkerül a verziókezelő rendszerbe és más is elérheti. Ilyen esetben a megoldás, hogy a lokális user secret-be tesszük ezt az értékel, és az alkalmazás majd onnan olvassa ki.</p>
</li>
<li>
<p>Adjuk hozzá a user secret-et a <code>BookShop.ConsoleApp</code> projekthez. Projekten jobb klikk -&gt; Manage User Secrets.</p>
<details class="info">
<summary>Segítség - User secrets kezelése</summary>
<figure>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="images/manage-user-secrets.png" data-desc-position="bottom"><img alt="Manage user secrets" src="images/manage-user-secrets.png"></a></p>
<figcaption>
<p>Felhasználói titkok kezelése</p>
</figcaption>
</figure>
</details>
</li>
<li>
<p>Amikor az alkalmazás beolvassa az <code>appsettings.json</code> fájlt azt követően beolvassa a secret-ben tárolt adatokat is (csak Development módban), és azzal felülírja az <code>appsettings.json</code>. Tehát egyszerűen át kell másolni az <code>AutoMapper</code> szekciót a secret-be.</p>
<div class="highlight"><span class="filename">secrets.json</span><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">"AutoMapper"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">"LicenseKey"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Ide jön a licenszkulcs"</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span><span class="w">    </span>
</code></pre></div>
</li>
<li>
<p>Ha meg szeretnénk találni a <code>usersecrets.json</code> akkor az <code>%APPDATA%\Microsoft\UserSecrets\&lt;user_secrets_id&gt;</code> könyvtárban kell keresni, nem a projekt vagy solution alatt. Fontos, hogy ez a fájl nincs titkosítva, viszont nem a kódbázis része, így nem kerül fel a verziókezelőbe se. A user secret egyedi azonosítóját, ami egy GUID a projekt fájlban találjuk meg a <code>UserSecretId</code> tagben.</p>
<details class="tip" open="open">
<summary>Hol van a usersecrets.json fájl?</summary>
<figure>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="images/find-user-secrets-json.png" data-desc-position="bottom"><img alt="Find user secrets.json" src="images/find-user-secrets-json.png"></a></p>
<figcaption>
<p>User secret fájl</p>
</figcaption>
</figure>
</details>
</li>
<li>
<p>Már csak annyi dolgunk van, hogy beállítsuk, hogy Development módban induljon el az alkalmazás. Ehhez a <code>DOTNET_ENVIRONMENT</code> környezeti változót kell <code>Development</code>-re állítani. Ennek a legegyszerűbb módja, hogy létrehozunk egy <code>launchSettings.json</code> fájlt és ott megadjuk. A projekt tulajdonsági között keressük meg a Debug részt és onnan nyissuk meg a debug launch profile UI-t és ott az Environment variables alá be is tudjuk másolni a Name-nek a <code>DOTNET_ENVIRONMENT</code> a Value-nak pedig a <code>Development</code> értéket.</p>
<details class="info" open="open">
<summary>Launch settings profile</summary>
<figure>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="images/set-development-mode.png" data-desc-position="bottom"><img alt="Set development mode" src="images/set-development-mode.png"></a></p>
<figcaption>
<p>Launch settings profile megnyitása és környezeti változó beállíása</p>
</figcaption>
</figure>
</details>
</li>
<li>
<p>Ha mindent jól csináltunk a solution explorer ablakban a projekt Properties mappájában meg is jelenik a <code>lauchSettings.json</code> fájl, így a későbbiekben egyszerűen itt tudjuk szerkeszteni.</p>
<details class="success" open="open">
<summary>A létrejött indítási profil</summary>
<figure>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="images/launch-settings.png" data-desc-position="bottom"><img alt="Launch settings" src="images/launch-settings.png"></a></p>
<figcaption>
<p>A létrejött launchSettings.json fájl.</p>
</figcaption>
</figure>
</details>
</li>
<li>
<p>Készítsük el a <code>Program.cs</code> kódját is, amiben hozzuk létre a HostApplicationBuilder példányunkat a <code>Host.CreateApplicationBuilder</code> segítségével. Ez fel fogja olvasni az <code>appsettings.json</code> fájlunkban és a userSecrets.json-ban lévő adatokat. Illetve hívjuk meg a korábban elkészített <code>AddBllServices</code> metódusunkat is.</p>
<div class="highlight"><span class="filename">Program.cs</span><pre><span></span><code><span class="k">using</span><span class="w"> </span><span class="nn">BookShop.Bll</span><span class="p">;</span>
<span class="k">using</span><span class="w"> </span><span class="nn">Microsoft.EntityFrameworkCore</span><span class="p">;</span>
<span class="k">using</span><span class="w"> </span><span class="nn">Microsoft.Extensions.DependencyInjection</span><span class="p">;</span>
<span class="k">using</span><span class="w"> </span><span class="nn">Microsoft.Extensions.Hosting</span><span class="p">;</span>

<span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">"Application starting..."</span><span class="p">);</span>

<span class="kt">var</span><span class="w"> </span><span class="n">builder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Host</span><span class="p">.</span><span class="n">CreateApplicationBuilder</span><span class="p">(</span><span class="n">args</span><span class="p">);</span>

<span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="n">builder</span><span class="p">.</span><span class="n">Environment</span><span class="p">.</span><span class="n">EnvironmentName</span><span class="p">);</span>

<span class="c1">// TODO: Register BLL services, DbContext and Automapper.</span>
<span class="n">builder</span><span class="p">.</span><span class="n">Services</span><span class="p">.</span><span class="n">AddBllServices</span><span class="p">(</span><span class="n">builder</span><span class="p">.</span><span class="n">Configuration</span><span class="p">);</span>

<span class="c1">// Host fordítása</span>
<span class="kt">var</span><span class="w"> </span><span class="n">app</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">builder</span><span class="p">.</span><span class="n">Build</span><span class="p">();</span>

<span class="c1">// Létrehozunk egy új scope-ot és abból kérjük le a szükséges osztály példányokat</span>
<span class="k">using</span><span class="w"> </span><span class="p">(</span><span class="kt">var</span><span class="w"> </span><span class="n">scope</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">app</span><span class="p">.</span><span class="n">Services</span><span class="p">.</span><span class="n">CreateScope</span><span class="p">())</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">scope</span><span class="p">.</span><span class="n">ServiceProvider</span><span class="p">.</span><span class="n">GetRequiredService</span><span class="o">&lt;</span><span class="n">BookShop</span><span class="p">.</span><span class="n">Dal</span><span class="p">.</span><span class="n">BookShopDbContext</span><span class="o">&gt;</span><span class="p">().</span><span class="n">Database</span><span class="p">.</span><span class="n">Migrate</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// TODO Call code from test service</span>
<span class="p">}</span>

<span class="k">await</span><span class="w"> </span><span class="n">app</span><span class="p">.</span><span class="n">RunAsync</span><span class="p">();</span>
</code></pre></div>
</li>
<li>
<p>Majd indítsuk is el az alkalmazást, hogy addig fusson amíg nem nyomjuk le a <span class="keys"><kbd class="key-control">Ctrl</kbd><span>+</span><kbd class="key-c">C</kbd></span> -t.</p>
</li>
<li>
<p>Figyeljük meg a fenti kódban, hogy a végén meghívjuk az adatbázis migrációt. Ha ez a sor benne marad a kódban, akkor nem kell sohasem futtatni az <code>Update-Database</code> parancsot, mert ez a kódsor le fogja futtatni azokat a migrációkat, amik még nem futottak. Érdemes azonban megjegyezni, hogy Production környezetben nem szeretjük ezt az automatikus megoldást, mert általában a migrációk lefuttatásához magasabb jogosultság szükséges mint az alkalmazás normál futtatásához.</p>
</li>
<li>Ahhoz, hogy a migráció le tudjon futni, létre kell hozni egy külön szkópot a szolgáltatásokhoz (AddScoped-ként adtuk hozzá), és abban a szkópban fogjuk megtalálni a <code>GetRequiredService</code> segítségével.</li>
<li>Ha elindítjuk az alkalmazást azt fogjuk látni, hogy valóban ellenőrizni, hogy minden EF migráció lefutott-e, ezt a konzolra naplózott SQL logokból láthatjuk.</li>
</ol>
<h3 id="irequestservice-keszitese">IRequestService készítése<a class="headerlink" href="#irequestservice-keszitese" title="Permanent link">¶</a></h3>
<p>Számos esetben van arra szükségünk a BLL-ben, vagy akár a DAL rétegben is, hogy elérjük az aktuális felhasználó ID-ját, vagy akár a nevét. Ezt úgy érdemes megvalósítani, hogy készítünk egy IRequestContext interfészt, aminek a megvalósítását a Web-es rétegre bízzuk, viszont az interfészen keresztül mindent el tudunk készíteni.</p>
<ol>
<li>
<p>A RequestContext-et több helyen szeretnénk használni és a körkörös referenciákat elkerülendő hozzunk létre egy <code>BookShop.Server.Abstraction</code> projektet (class library) és abban egy <code>Context</code> mappát, ami az alábbi kóddal hozzuk létre az <code>IRequestContext</code> interfészt.</p>
<div class="highlight"><span class="filename">IRequestService.cs</span><pre><span></span><code><span class="k">using</span><span class="w"> </span><span class="nn">System.Security.Claims</span><span class="p">;</span>

<span class="k">namespace</span><span class="w"> </span><span class="nn">BookShop.Server.Abstraction.Context</span><span class="p">;</span>

<span class="c1">/// &lt;summary&gt;</span>
<span class="c1">/// Gets the request's sender's request's identifier and user information.</span>
<span class="c1">/// &lt;/summary&gt;</span>
<span class="k">public</span><span class="w"> </span><span class="k">interface</span><span class="w"> </span><span class="n">IRequestContext</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">string?</span><span class="w"> </span><span class="n">RequestId</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="n">ClaimsIdentity</span><span class="o">?</span><span class="w"> </span><span class="n">CurrentUser</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">int?</span><span class="w"> </span><span class="n">UserId</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</li>
<li>
<p>A későbbiekben a <code>CommentService</code> és <code>RatingService</code>-ben szeretnénk ezt használni, hogy a hozzászólást és értékelés mindig az aktuális felhasználó nevében történjen. Ehhez csak annyi lesz a dolgunk, hogy átadjuk a konstruktornak paraméterben és a userId-t a requestContext-ből olvassuk ki. Illetve a startup projektbe beregisztráljuk hozzá a megfelelő implementációt.</p>
</li>
<li>A fenti megoldást érdemes már a projekt elején használni így mock-olva a belépett felhasználót.</li>
</ol>
<h3 id="testmycode-szolgaltatas">TestMyCode szolgáltatás<a class="headerlink" href="#testmycode-szolgaltatas" title="Permanent link">¶</a></h3>
<ol>
<li>
<p>Ahhoz, hogy a mi kódunkat is le tudjuk tesztelni egyszerűen, hozzunk létre egy <code>TestMyCode</code> osztályt, melynek konstruktora megkapja az <code>IBookService</code> és <code>ICategoryService</code> interfészeket és implementál két metódust <code>ListBooksAsync</code> és <code>ListCategoriesAsync</code> melyek meghívják az egyes szolgáltatások megfelelő metódusát és a konzolra kiírják a visszakapott listák elemet.</p>
<div class="highlight"><span class="filename">TestMyCode.cs</span><pre><span></span><code><span class="k">using</span><span class="w"> </span><span class="nn">BookShop.Bll.ServicesInterfaces</span><span class="p">;</span>

<span class="k">namespace</span><span class="w"> </span><span class="nn">BookShop.ConsoleApp</span><span class="p">;</span>

<span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nf">TestMyCode</span><span class="p">(</span><span class="n">IBookService</span><span class="w"> </span><span class="n">bookService</span><span class="p">,</span><span class="w"> </span><span class="n">ICategoryService</span><span class="w"> </span><span class="n">categoryService</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="n">Task</span><span class="w"> </span><span class="nf">ListBooksAsync</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">books</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="n">bookService</span><span class="p">.</span><span class="n">GetBooksAsync</span><span class="p">();</span>

<span class="w">        </span><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="kt">var</span><span class="w"> </span><span class="n">book</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">books</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">$"{book.Id}: {book.Title} - {book.Author} ({book.PublishYear})"</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="n">Task</span><span class="w"> </span><span class="nf">ListCategoriesAsync</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">categories</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="n">categoryService</span><span class="p">.</span><span class="n">GetCategoryTreeAsync</span><span class="p">();</span>

<span class="w">        </span><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="kt">var</span><span class="w"> </span><span class="n">category</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">categories</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">$"{new string(' ', (category.Level - 1) * 2)}- {category.Name}  (Level:   {category.Level})"</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</li>
<li>
<p>Már csak annyi dolgunk van, hogy a <code>Program.cs</code>-ből meghívjuk a két metódust, viszont mivel manuálisan nem tudjuk ezt az osztály példányosítani, így ezt is hozzá kell adni a Services-hez és onnan kell a példányt elkérni.</p>
<div class="highlight"><span class="filename">Program.cs</span><pre><span></span><code><span class="c1">// Register BLL services, DbContext and Automapper.</span>
<span class="n">builder</span><span class="p">.</span><span class="n">Services</span><span class="p">.</span><span class="n">AddBllServices</span><span class="p">(</span><span class="n">builder</span><span class="p">.</span><span class="n">Configuration</span><span class="p">);</span>
<span class="hll"><span class="n">builder</span><span class="p">.</span><span class="n">Services</span><span class="p">.</span><span class="n">AddScoped</span><span class="o">&lt;</span><span class="n">TestMyCode</span><span class="o">&gt;</span><span class="p">();</span>
</span>
<span class="c1">// Host fordítása</span>
<span class="kt">var</span><span class="w"> </span><span class="n">app</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">builder</span><span class="p">.</span><span class="n">Build</span><span class="p">();</span>

<span class="c1">// Létrehozunk egy új scope-ot és abból kérjük le a szükséges osztály példányokat</span>
<span class="k">using</span><span class="w"> </span><span class="p">(</span><span class="kt">var</span><span class="w"> </span><span class="n">scope</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">app</span><span class="p">.</span><span class="n">Services</span><span class="p">.</span><span class="n">CreateScope</span><span class="p">())</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">scope</span><span class="p">.</span><span class="n">ServiceProvider</span><span class="p">.</span><span class="n">GetRequiredService</span><span class="o">&lt;</span><span class="n">BookShop</span><span class="p">.</span><span class="n">Dal</span><span class="p">.</span><span class="n">BookShopDbContext</span><span class="o">&gt;</span><span class="p">().</span><span class="n">Database</span><span class="p">.</span><span class="n">Migrate</span><span class="p">();</span>

<span class="hll"><span class="w">    </span><span class="kt">var</span><span class="w"> </span><span class="n">testMyCodeService</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">scope</span><span class="p">.</span><span class="n">ServiceProvider</span><span class="p">.</span><span class="n">GetRequiredService</span><span class="o">&lt;</span><span class="n">TestMyCode</span><span class="o">&gt;</span><span class="p">();</span>
</span><span class="hll">
</span><span class="hll"><span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="n">testMyCodeService</span><span class="p">.</span><span class="n">ListBooksAsync</span><span class="p">();</span>
</span><span class="hll"><span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="n">testMyCodeService</span><span class="p">.</span><span class="n">ListCategoriesAsync</span><span class="p">();</span>
</span><span class="p">}</span>


<span class="k">await</span><span class="w"> </span><span class="n">app</span><span class="p">.</span><span class="n">RunAsync</span><span class="p">();</span>
</code></pre></div>
</li>
<li>
<p>Ha így elindítjuk az alkalmazást, akkor látható lesz, hogy tényleg megkapjuk az adatokat az adatbázisból, sőt a futtatott SQL kódot is látjuk.</p>
</li>
</ol>
<h2 id="aspnet-identity-tablak-letrehozasa">ASP.NET Identity táblák létrehozása<a class="headerlink" href="#aspnet-identity-tablak-letrehozasa" title="Permanent link">¶</a></h2>
<p>Minden alkalmazásban szükség van felhasználókezelésre. Ehhez kiváló támogatást az ASP.NET Identity, ami több szinten nyújt segítséget. Adatbázis szinten létre tudja hozni a táblákat és a User entitást a nélkül, hogy a magasabb szintű szolgáltatásait igénybe vennénk.</p>
<ol>
<li>Adjuk hozzá a <code>BookShop.Dal</code> projekthez a <code>Microsoft.AspNetCore.Identity.EntityFrameworkCore</code> NuGet package-et. Ez szükséges ahhoz, hogy a User entitásokat le tudjuk származtatni az IdentityUser osztályból, illetve a DbContext-et az IdentityDbContext-ből.</li>
<li>
<p>Az <code>Entities</code> mappába hozzuk létre az <code>ApplicationUser</code> entitást. Az osztály származzon az <code>IdentityUser&lt;int&gt;</code>-ből. Ezzel megadjuk, hogy a felhasználó egyedi azonosítója <code>int</code> legyen és a származás miatt belekerülnek a legfontosabb tulajdonságok az osztályba.</p>
<div class="highlight"><span class="filename">ApplicationUser.cs</span><pre><span></span><code><span class="k">using</span><span class="w"> </span><span class="nn">Microsoft.AspNetCore.Identity</span><span class="p">;</span>

<span class="k">namespace</span><span class="w"> </span><span class="nn">BookShop.Dal.Entities</span><span class="p">;</span>

<span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">ApplicationUser</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">IdentityUser</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">DisplayName</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">null</span><span class="o">!</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
</li>
<li>
<p>Ezt követően módosítsuk a <code>BookShopDbContext</code>-ünket, hogy az <code>IdentityDbContext&lt;&gt;</code>-ből származzon.</p>
<div class="highlight"><span class="filename">BookShopDbContext.cs</span><pre><span></span><code><span class="k">using</span><span class="w"> </span><span class="nn">BookShop.Dal.Entities</span><span class="p">;</span>
<span class="k">using</span><span class="w"> </span><span class="nn">Microsoft.AspNetCore.Identity</span><span class="p">;</span>
<span class="k">using</span><span class="w"> </span><span class="nn">Microsoft.AspNetCore.Identity.EntityFrameworkCore</span><span class="p">;</span>
<span class="k">using</span><span class="w"> </span><span class="nn">Microsoft.EntityFrameworkCore</span><span class="p">;</span>

<span class="k">namespace</span><span class="w"> </span><span class="nn">BookShop.Dal</span><span class="p">;</span>

<span class="hll"><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nf">BookShopDbContext</span><span class="p">(</span><span class="n">DbContextOptions</span><span class="w"> </span><span class="n">options</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">IdentityDbContext</span><span class="o">&lt;</span><span class="n">ApplicationUser</span><span class="p">,</span><span class="w"> </span><span class="n">IdentityRole</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">options</span><span class="p">)</span>
</span><span class="p">{</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">DbSet</span><span class="o">&lt;</span><span class="n">Book</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Books</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">DbSet</span><span class="o">&lt;</span><span class="n">Category</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Categories</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="p">...</span>
<span class="p">}</span>
</code></pre></div>
</li>
<li>
<p>Adjuk hozzá a DB modellhez is, az ApplicationUser-t és jelenítsük meg az ősosztályát is, és így már látható is, hogy az összes fontos tulajdonságot megörökli.</p>
<figure>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="images/Db-diagram-Identity.png" data-desc-position="bottom"><img alt="DB diaram identity-vel" src="images/Db-diagram-Identity.png"></a></p>
<figcaption>
<p>DB diagram ApplicationUser-rel</p>
</figcaption>
</figure>
</li>
<li>
<p>Majd hozzuk létre az új migrációt, de ehhez a Startup projektet állítsuk át a <code>BookShop.Dal</code>-ra és futtassuk is le.</p>
<div class="highlight"><pre><span></span><code><span class="nb">Add-Migration</span> <span class="n">AddIndentity</span>

<span class="nb">Update-Database</span>
</code></pre></div>
</li>
<li>
<p>Ez után már láthatóak az Identity-s táblák is az adatbázisban. Figyeljük meg, hogy az <code>AspNetUsers</code> táblába bekerült az <code>ApplicationUser</code> entitásban lévő <code>DisplayName</code> mező is.</p>
<figure>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="images/db-tables-identity.png" data-desc-position="bottom"><img alt="Adatbázis táblák Identity-vel" src="images/db-tables-identity.png"></a></p>
<figcaption>
<p>Létrehozott ASP.NET Identity táblák.</p>
</figcaption>
</figure>
</li>
</ol>
<h2 id="teljes-dal-reteg">Teljes DAL réteg<a class="headerlink" href="#teljes-dal-reteg" title="Permanent link">¶</a></h2>
<p>Ezek alapján már el tudnánk készíteni a teljes adatelérési réteget, de mivel az sok időt vesz igénybe ezért az a következő labor kiinduló anyagába már benne lesz.</p>
  <hr>
  <div class="md-source-file">
    <span class="md-source-file__fact"> <span class="md-icon" title="Utolsó frissítés"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
          <path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1-2.1-2M12.5 7v5.2l4 2.4-1 1L11 13V7h1.5M11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2v1.8Z">
          </path>
        </svg>
      </span>
      <span title="2026. január 13. 19:00:41">
        <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago" title="2026. január 13. 19:00:41 CET"><span class="timeago" datetime="2026-01-13T19:00:41+01:00" locale="hu"></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date" title="2026. január 13. 19:00:41 CET">2026-01-13</span>
      </span>
    </span>

    

    <span class="md-source-file__fact">
      <span class="md-icon" title="Szerzők">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
          <path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z">
          </path>
        </svg>
      </span>
      <span>Szerzők</span>
      <nav></nav>      
    </span>
  </div>




                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"></path></svg>
  Vissza a tetejére
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright © BME VIK AUT
    </div>
  
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": ["content.code.copy", "content.code.select", "navigation.tabs", "navigation.top", "search.suggest", "content.action.edit", "toc.follow"], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "V\u00e1g\u00f3lapra m\u00e1solva", "clipboard.copy": "M\u00e1sol\u00e1s v\u00e1g\u00f3lapra", "search.result.more.one": "1 tov\u00e1bbi tal\u00e1lat az oldalon", "search.result.more.other": "# tov\u00e1bbi tal\u00e1lat az oldalon", "search.result.none": "Nincs tal\u00e1lat", "search.result.one": "1 egyez\u0151 dokumentum", "search.result.other": "# egyez\u0151 dokumentum", "search.result.placeholder": "Keres\u00e9shez \u00edrj ide valamit", "search.result.term.missing": "\u00dcres", "select.version": "Verzi\u00f3v\u00e1lt\u00e1s"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
        <script src="../../js/timeago.min.js"></script>
      
        <script src="../../js/timeago_mkdocs_material.js"></script>
      
    
  
<script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(()=>{ lightbox.reload(); });
</script></body></html>